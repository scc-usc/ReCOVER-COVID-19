(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[19],{1185:function(e,t,a){"use strict";a.r(t);a(154);var n=a(164),r=(a(200),a(216)),o=(a(857),a(995)),c=(a(201),a(238)),s=(a(439),a(437)),i=(a(202),a(235)),l=(a(859),a(1097)),u=a(196),h=a(525),d=a(526),f=a(610),p=a(13),m=a(14),v=a(27),y=a(17),k=a(16),g=(a(239),a(237)),b=a(0),D=a.n(b),S=a(861),O=a.n(S),w="https://dslab-covid19-backend.herokuapp.com/api",j=function(){function e(){Object(p.a)(this,e)}return Object(m.a)(e,[{key:"affected_by",value:function(e){}},{key:"areas",value:function(e){var t="".concat(w,"/areas");O.a.get(t).then((function(t){var a=t.data;e(a)}))}},{key:"models",value:function(e){var t="".concat(w,"/models");O.a.get(t).then((function(t){var a=t.data;e(a)}))}},{key:"infection_models",value:function(e){var t="".concat(w,"/infection_models");O.a.get(t).then((function(t){var a=t.data;e(a)}))}},{key:"death_models",value:function(e){var t="".concat(w,"/death_models");O.a.get(t).then((function(t){var a=t.data;e(a)}))}},{key:"cumulative_infections",value:function(e){var t="".concat(w,"/cumulative_infections");O.a.get(t).then((function(t){return e(t.data)}))}},{key:"predict_all",value:function(e,t){var a="".concat(w,"/predict_all");O.a.get(a,{params:e}).then((function(e){return t(e.data)}))}},{key:"predict",value:function(e,t){var a="".concat(w,"/predict");O.a.get(a,{params:e}).then((function(e){t(e.data)}))}},{key:"getCurrentDate",value:function(e){var t="".concat(w,"/current_date");O.a.get(t).then((function(t){var a=t.data;e(a)}))}},{key:"checkHistory",value:function(e,t){var a="".concat(w,"/check_history");O.a.get(a,{params:e}).then((function(e){t(e.data)}))}},{key:"history_cumulative",value:function(e,t){var a="".concat(w,"/history_cumulative");O.a.get(a,{params:e}).then((function(e){t(e.data)}))}},{key:"scores_all",value:function(e,t){var a="".concat(w,"/scores_all");O.a.get(a,{params:e}).then((function(e){t(e.data)}))}},{key:"scores",value:function(e,t){var a="".concat(w,"/scores");O.a.get(a,{params:e}).then((function(e){t(e.data)}))}},{key:"latest_score_date",value:function(e){var t="".concat(w,"/latest_score_date");O.a.get(t).then((function(t){var a=t.data;e(a)}))}},{key:"cumulative_death",value:function(e,t){var a="".concat(w,"/cumulative_death");O.a.get(a,{params:e}).then((function(e){t(e.data)}))}},{key:"all_mrf_scores",value:function(e,t){var a="".concat(w,"/all_mrf_scores");O.a.get(a,{params:e}).then((function(e){t(e.data)}))}},{key:"real_time",value:function(e){O.a.get("https://api.covid19api.com/summary").then((function(t){var a=t.data.Global.TotalConfirmed,n=t.data.Global.TotalDeaths;e({totalConfirmed:a,totalDeaths:n})}))}}]),e}();function C(e){return"".concat(e.country).concat(e.state?" / "+e.state:"")}var E=a(203),_=a(878),M=a.n(_),A=a(214),W=a.n(A),T=a(535);var x=function(e){var t=e.series,a=e.lineGenerator,n=e.xScale,r=e.yScale;return t.map((function(e){var t=e.id,o=e.data,c=e.color,s=e.predicted,i=e.distancing,l={strokeWidth:5};return s&&(l.strokeDasharray=i?"6, 4":"2, 6"),D.a.createElement("path",{key:t,d:a(o.map((function(e){return{x:n(e.data.x),y:r(e.data.y)}}))),fill:"none",stroke:c,style:l})}))},I={axis:{ticks:{text:{fontSize:18}},legend:{text:{fontSize:18}}},legends:{text:{fontSize:18}}},P=(b.Component,a(1095));var R=function(e){Object(y.a)(a,e);var t=Object(k.a)(a);function a(){var e;Object(p.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).parseData=function(e,t){var a=Object.keys(e)[0];if(e[a])return"reproduction"===t?e[a].observed_rt.map((function(t,a){var n={name:t.date.split("-")[1]+"/"+t.date.split("-")[2]};n[Object.keys(e)[0]]=t.value,n["error".concat(Object.keys(e)[0])]=t.conf;for(var r=1;r<Object.keys(e).length;++r)n[Object.keys(e)[r]]=e[Object.keys(e)[r]].observed_rt[a].value,n["error".concat(Object.keys(e)[r])]=e[Object.keys(e)[r]].observed_rt[a].conf;return n})):e[a].observed_mrf.map((function(t,a){var n={name:t.date.split("-")[1]+"/"+t.date.split("-")[2]};n[Object.keys(e)[0]]=t.value,n["error".concat(Object.keys(e)[0])]=t.conf;for(var r=1;r<Object.keys(e).length;++r)n[Object.keys(e)[r]]=e[Object.keys(e)[r]].observed_mrf[a].value,n["error".concat(Object.keys(e)[r])]=e[Object.keys(e)[r]].observed_mrf[a].conf;return n}))},e}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props,t=e.data,a=e.date,n=e.scoreType,r=this.parseData(t,n),o=Object.keys(t),c=[];o.map((function(e,t){var a=function(e){var t=[T.red,T.gold,T.lime,T.cyan,T.geekblue,T.purple,T.magenta];return t[e%t.length]}(t);return c.push(a),0}));for(var s=[],i=0;i<o.length;++i)s.push(D.a.createElement(P.e,{type:"monotone",key:i,dataKey:o[i],stroke:c[i][3],strokeWidth:5},D.a.createElement(P.b,{dataKey:"error".concat(o[i]),width:15,strokeWidth:2,stroke:c[i][6],direction:"y"})));return D.a.createElement(P.f,{width:1400,height:300,data:r,margin:{top:40,right:30,left:40,bottom:5}},D.a.createElement(P.a,{strokeDasharray:"3 3"}),D.a.createElement(P.i,{dataKey:"name"}),D.a.createElement(P.j,null,"reproduction"===n?D.a.createElement(P.c,{value:"Dynamic Reproduction Number",dy:90,position:"insideLeft",angle:-90,fontSize:15}):D.a.createElement(P.c,{value:"MFR Score",dy:45,position:"insideLeft",angle:-90,fontSize:15})),D.a.createElement(P.h,null),D.a.createElement(P.g,{x:a,stroke:"green",strokeWidth:5,fontSize:20,label:{position:"top",value:"selected date",fill:"green",fontSize:15},strokeDasharray:"10 10"}),"reproduction"===n?D.a.createElement(P.g,{y:1,stroke:"SandyBrown",strokeWidth:5,strokeDasharray:"3 3",label:{position:"left",value:"",fill:"red",fontSize:20}}):null,D.a.createElement(P.d,{iconSize:40}),s)}}]),a}(b.Component),N=a(1096),B=a(1094),V=a(976),z=a(977),G=a(1102);N.e(G.a);var F=function(e){Object(y.a)(a,e);var t=Object(k.a)(a);function a(){var e;return Object(p.a)(this,a),(e=t.call(this)).onShowState=function(t){e.setState({showState:t})},e.modelAPI=new j,e.state={areasList:[],showState:!1,worldSeries:{},usaSeries:{}},e.modelAPI.areas((function(t){return e.setState({areasList:t})})),e}return Object(m.a)(a,[{key:"componentDidMount",value:function(){this.props.triggerRef(this)}},{key:"fetchData",value:function(){var e=this,t=arguments,a=this.props.scoreType;t[0]?"reproduction"===a?this.modelAPI.scores_all({weeks:this.props.weeks},(function(a){var n=a.map((function(e){return{id:e.area.iso_2,value:e.value>0?e.value:0,area:e.area}}));t[1]?e.setState({heatmapData:n},e.initChart):e.setState({heatmapData:n},e.updateChart)})):this.modelAPI.all_mrf_scores({weeks:this.props.weeks},(function(a){var n=a.map((function(e){return{id:e.area.iso_2,value:e.value>0?e.value:0,area:e.area}}));t[1]?e.setState({heatmapData:n},e.initChart):e.setState({heatmapData:n},e.updateChart)})):"reproduction"===a?this.modelAPI.scores_all({weeks:this.props.latestWeek},(function(t){var a=t.map((function(e){return{id:e.area.iso_2,value:e.value>0?e.value:0,area:e.area,conf:e.conf}}));e.setState({heatmapData:a},e.initChart)})):this.modelAPI.all_mrf_scores({weeks:this.props.latestWeek},(function(t){var a=t.map((function(e){return{id:e.area.iso_2,value:e.value>0?e.value:0,area:e.area,conf:e.conf}}));e.setState({heatmapData:a},e.initChart)}))}},{key:"initChart",value:function(){this.chart=N.d("chartdiv",B.a),this.chart.projection=new B.d.Mercator;var e=this.chart.series.push(new B.b);e=this.createChartSeries(e,{geodata:V.a,exclude:["AQ"],data:this.state.heatmapData});var t=this.chart.series.push(new B.b);t=this.createChartSeries(t,{geodata:z.a,data:this.state.heatmapData,disabled:!this.state.showState}),this.stateSeries=[t],this.initChartInterface(),this.setState({worldSeries:e,usaSeries:t})}},{key:"updateChart",value:function(){var e=this.state.worldSeries,t=this.state.usaSeries;e.data=this.state.heatmapData,t.data=this.state.heatmapData}},{key:"createChartSeries",value:function(e,t){var a=this.props.scoreType,n=(e=Object.assign(e,t)).mapPolygons.template;"reproduction"===a?e.heatRules.push({property:"fill",target:n,min:N.c("#85DB50"),max:N.c("#F33A21"),minValue:0,maxValue:4}):e.heatRules.push({property:"fill",target:n,min:N.c("#85DB50"),max:N.c("#F33A21"),minValue:0,maxValue:.4}),n.tooltipText="{name}: {value}",n.nonScalingStroke=!0,n.strokeWidth=.5,n.states.create("hover").properties.fill=N.c("#83FE00"),n.cursorOverStyle=N.b.pointer;var r=this.props,o=r.onMapClick,c=r.onNoData;return n.events.on("hit",(function(e){var t=e.target.dataItem.dataContext,a=(t.id,t.value,t.area),n=t.name;a?o(a):c(n)})),e}},{key:"initChartInterface",value:function(){var e=this,t=this.state.showState;this.chart.zoomControl=new B.c,this.chart.zoomControl.cursorOverStyle=N.b.pointer;var a=this.chart.chartContainer.createChild(N.a);a.label.text="".concat(t?"Hide":"Show"," States/Provinces"),a.togglable=!0,a.padding(5,5,5,5),a.align="right",a.marginRight=15,a.cursorOverStyle=N.b.pointer,a.events.on("hit",(function(){e.onShowState(a.isActive);var t=e.state.showState;e.stateSeries.forEach((function(e){return e.disabled=!t})),a.label.text="".concat(t?"Hide":"Show"," States/Provinces")}))}},{key:"componentWillUnmount",value:function(){this.chart&&this.chart.dispose()}},{key:"render",value:function(){return D.a.createElement("div",{id:"chartdiv"})}}]),a}(b.Component),L=(a(978),g.a.Option),H=function(e){Object(y.a)(a,e);var t=Object(k.a)(a);function a(e){var n;return Object(p.a)(this,a),(n=t.call(this,e)).componentDidMount=function(){n.formRef=D.a.createRef(),n.modelAPI=new j,n.modelAPI.latest_score_date((function(e){return n.setState({latestDate:e[0].date,weeks:e[0].weeks,latestWeek:e[0].weeks,firstDate:e[0].firstDate},(function(){n.addAreaByStr("US"),n.formRef.current.setFieldsValue({weeks:n.state.latestWeek}),n.map.fetchData(n.state.dynamicMapOn)}))})),n.modelAPI.areas((function(e){return n.setState({areasList:e})}))},n.bindRef=function(e){n.map=e},n.onAlertClose=function(){n.setState({noDataError:!1})},n.onNoData=function(e){n.setState({noDataError:!0,errorDescription:"There is currently no data for ".concat(e)})},n.generateMarks=function(){var e=n.state,t=e.weeks,a=(e.lastDate,e.latestWeek),r=e.firstDate,o=new Date("".concat(r,"T00:00"));o.setDate(o.getDate(Date)+7*t);for(var c={},s=0;s<=5&&t+s<=a;)c[t+s]="".concat(o.getMonth()+1,"/").concat(o.getDate()),o.setDate(o.getDate(Date)+7),s++;for(s=1,(o=new Date("".concat(r,"T00:00"))).setDate(o.getDate(Date)+7*(t-1));s<=5&&t-s>=0;)c[t-s]="".concat(o.getMonth()+1,"/").concat(o.getDate()),o.setDate(o.getDate(Date)-7),s++;return(o=new Date("".concat(r,"T00:00"))).setDate(o.getDate(Date)+7*t),[o,c]},n.handleScoreTypeSelect=function(e){n.setState({scoreType:e.target.value},(function(){n.map.fetchData(n.state.dynamicMapOn,!0)}))},n.state={areas:n.props.areas||[],areasList:[],latestDate:"",firstDate:"",mainGraphData:{},weeks:n.props.weeks||0,latestWeek:0,dynamicMapOn:!1,noDataError:!1,errorDescription:"",scoreType:"reproduction"},n.addAreaByStr=n.addAreaByStr.bind(Object(v.a)(n)),n.removeAreaByStr=n.removeAreaByStr.bind(Object(v.a)(n)),n.onValuesChange=n.onValuesChange.bind(Object(v.a)(n)),n.onMapClick=n.onMapClick.bind(Object(v.a)(n)),n.onWeeksChange=n.onWeeksChange.bind(Object(v.a)(n)),n.switchDynamicMap=n.switchDynamicMap.bind(Object(v.a)(n)),n.onAlertClose=n.onAlertClose.bind(Object(v.a)(n)),n.onNoData=n.onNoData.bind(Object(v.a)(n)),n.generateMarks=n.generateMarks.bind(Object(v.a)(n)),n.handleScoreTypeSelect=n.handleScoreTypeSelect.bind(Object(v.a)(n)),n}return Object(m.a)(a,[{key:"onMapClick",value:function(e){this.areaIsSelected(e)||this.addAreaByStr(C(e))}},{key:"areaIsSelected",value:function(e){if(this.state.areas&&e){var t=C(e);return this.state.areas.includes(t)}return!1}},{key:"addAreaByStr",value:function(e){var t=this,a=function(e){var t=e.split("/");return{country:t[0].trim(),state:2===t.length?t[1].trim():""}}(e);this.setState((function(t){return{areas:[].concat(Object(f.a)(t.areas),[e])}}),(function(){t.modelAPI.scores({state:a.state,country:a.country,weeks:t.state.latestWeek},(function(a){t.setState((function(t){return{mainGraphData:Object(d.a)({},t.mainGraphData,Object(h.a)({},e,a))}}))})),t.formRef.current.setFieldsValue({areas:t.state.areas})}))}},{key:"removeAreaByStr",value:function(e){this.setState((function(t){return{areas:t.areas.filter((function(t){return t!==e})),mainGraphData:Object.keys(t.mainGraphData).filter((function(t){return t!==e})).reduce((function(e,a){return Object(d.a)({},e,Object(h.a)({},a,t.mainGraphData[a]))}),{})}}))}},{key:"onValuesChange",value:function(e,t){var a=this.state.areas,n=t.areas;if(n&&a){var r=n.filter((function(e){return!a.includes(e)})),o=a.filter((function(e){return!n.includes(e)}));r.forEach(this.addAreaByStr),o.forEach(this.removeAreaByStr)}}},{key:"onWeeksChange",value:function(e){var t=this;this.setState({weeks:e},(function(){t.state.dynamicMapOn&&t.map.fetchData(t.state.dynamicMapOn)}))}},{key:"switchDynamicMap",value:function(e){this.setState({dynamicMapOn:e}),this.map.fetchData(e)}},{key:"render",value:function(){var e=this,t=this.state,a=t.areas,h=t.areasList,d=t.weeks,f=t.mainGraphData,p=t.dynamicMapOn,m=t.latestWeek,v=t.noDataError,y=t.errorDescription,k=t.scoreType,b=h.filter((function(t){return!e.areaIsSelected(t)})).map(C).sort().map((function(e){return D.a.createElement(L,{key:e}," ",e," ")})),S=this.generateMarks(),O=Object(u.a)(S,2),w=O[0],j=O[1],E=w.getMonth()+1<10?"0".concat(w.getMonth()+1):w.getMonth()+1,_=w.getDate()<10?"0".concat(w.getDate()):w.getDate(),M="".concat(E,"/").concat(_);return D.a.createElement("div",{className:"score-page"},D.a.createElement(n.a,{type:"flex",justify:"space-around"},D.a.createElement(r.a,{span:10},v?D.a.createElement(l.a,{message:"".concat(y),description:"Please wait for our updates.",type:"error",closable:!0,onClose:this.onAlertClose}):null,D.a.createElement("div",{className:"form-wrapper"},D.a.createElement(i.a,{ref:this.formRef,onValuesChange:this.onValuesChange},D.a.createElement(i.a.Item,{label:"Areas",name:"areas",rules:[{required:!0,message:"Please select areas!"}]},D.a.createElement(g.a,{mode:"multiple",style:{width:"100%"},placeholder:"Select Areas"},b)),D.a.createElement(i.a.Item,{label:"Week to check",name:"weeks",rules:[{required:!0,message:"Please select the week you want to see"}]},D.a.createElement(s.a,{marks:j,initialValue:d,min:d-5>=0?d-5:0,max:d+5<=m?d+5:m,onAfterChange:this.onWeeksChange}))),D.a.createElement("div",{className:"radio-group"},"Data Type:\xa0\xa0",D.a.createElement(c.a.Group,{value:k,onChange:this.handleScoreTypeSelect},D.a.createElement(c.a,{value:"reproduction"},"Dynamic Reproduction Number"),D.a.createElement(c.a,{value:"mfr"},"Model-based Fatality Rate"))),D.a.createElement("p",null,"Dynamic Map:\xa0\xa0",D.a.createElement(o.a,{onChange:this.switchDynamicMap})))),D.a.createElement(r.a,{span:14},D.a.createElement("div",{className:"map-wrapper"},D.a.createElement(F,{className:"score-map",triggerRef:this.bindRef,dynamicMapOn:p,weeks:d,latestWeek:m,onMapClick:this.onMapClick,onNoData:this.onNoData,scoreType:k})))),a.length?D.a.createElement(n.a,null,D.a.createElement(r.a,{span:24},D.a.createElement("div",{className:"graph-wrapper"},D.a.createElement(R,{data:f,date:M,scoreType:k})))):null)}}]),a}(b.PureComponent);t.default=H},978:function(e,t,a){}}]);
//# sourceMappingURL=19.41063f00.chunk.js.map