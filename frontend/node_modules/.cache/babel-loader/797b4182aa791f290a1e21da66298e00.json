{"ast":null,"code":"import { range } from \"d3-array\";\nimport { geoStream, geoProjectionMutator as projectionMutator } from \"d3-geo\";\nimport { collignonRaw } from \"./collignon.js\";\nimport { cylindricalEqualAreaRaw } from \"./cylindricalEqualArea.js\";\nimport { abs, asin, degrees, epsilon, floor, max, min, pi, radians, sqrtPi, tau } from \"./math.js\";\nvar K = 3,\n    healpixParallel = asin(1 - 1 / K) * degrees,\n    healpixLambert = cylindricalEqualAreaRaw(0);\nexport function healpixRaw(H) {\n  var phi0 = healpixParallel * radians,\n      dx = collignonRaw(pi, phi0)[0] - collignonRaw(-pi, phi0)[0],\n      y0 = healpixLambert(0, phi0)[1],\n      y1 = collignonRaw(0, phi0)[1],\n      dy1 = sqrtPi - y1,\n      k = tau / H,\n      w = 4 / tau,\n      h = y0 + dy1 * dy1 * 4 / tau;\n\n  function forward(lambda, phi) {\n    var point,\n        phi2 = abs(phi);\n\n    if (phi2 > phi0) {\n      var i = min(H - 1, max(0, floor((lambda + pi) / k)));\n      lambda += pi * (H - 1) / H - i * k;\n      point = collignonRaw(lambda, phi2);\n      point[0] = point[0] * tau / dx - tau * (H - 1) / (2 * H) + i * tau / H;\n      point[1] = y0 + (point[1] - y1) * 4 * dy1 / tau;\n      if (phi < 0) point[1] = -point[1];\n    } else {\n      point = healpixLambert(lambda, phi);\n    }\n\n    point[0] *= w, point[1] /= h;\n    return point;\n  }\n\n  forward.invert = function (x, y) {\n    x /= w, y *= h;\n    var y2 = abs(y);\n\n    if (y2 > y0) {\n      var i = min(H - 1, max(0, floor((x + pi) / k)));\n      x = (x + pi * (H - 1) / H - i * k) * dx / tau;\n      var point = collignonRaw.invert(x, 0.25 * (y2 - y0) * tau / dy1 + y1);\n      point[0] -= pi * (H - 1) / H - i * k;\n      if (y < 0) point[1] = -point[1];\n      return point;\n    }\n\n    return healpixLambert.invert(x, y);\n  };\n\n  return forward;\n}\n\nfunction sphereTop(x, i) {\n  return [x, i & 1 ? 90 - epsilon : healpixParallel];\n}\n\nfunction sphereBottom(x, i) {\n  return [x, i & 1 ? -90 + epsilon : -healpixParallel];\n}\n\nfunction sphereNudge(d) {\n  return [d[0] * (1 - epsilon), d[1]];\n}\n\nfunction sphere(step) {\n  var c = [].concat(range(-180, 180 + step / 2, step).map(sphereTop), range(180, -180 - step / 2, -step).map(sphereBottom));\n  return {\n    type: \"Polygon\",\n    coordinates: [step === 180 ? c.map(sphereNudge) : c]\n  };\n}\n\nexport default function () {\n  var H = 4,\n      m = projectionMutator(healpixRaw),\n      p = m(H),\n      stream_ = p.stream;\n\n  p.lobes = function (_) {\n    return arguments.length ? m(H = +_) : H;\n  };\n\n  p.stream = function (stream) {\n    var rotate = p.rotate(),\n        rotateStream = stream_(stream),\n        sphereStream = (p.rotate([0, 0]), stream_(stream));\n    p.rotate(rotate);\n\n    rotateStream.sphere = function () {\n      geoStream(sphere(180 / H), sphereStream);\n    };\n\n    return rotateStream;\n  };\n\n  return p.scale(239.75);\n}","map":{"version":3,"sources":["/Users/tianjianxu/Documents/GitHub/ReCOVER-COVID-19/frontend/node_modules/d3-geo-projection/src/healpix.js"],"names":["range","geoStream","geoProjectionMutator","projectionMutator","collignonRaw","cylindricalEqualAreaRaw","abs","asin","degrees","epsilon","floor","max","min","pi","radians","sqrtPi","tau","K","healpixParallel","healpixLambert","healpixRaw","H","phi0","dx","y0","y1","dy1","k","w","h","forward","lambda","phi","point","phi2","i","invert","x","y","y2","sphereTop","sphereBottom","sphereNudge","d","sphere","step","c","concat","map","type","coordinates","m","p","stream_","stream","lobes","_","arguments","length","rotate","rotateStream","sphereStream","scale"],"mappings":"AAAA,SAAQA,KAAR,QAAoB,UAApB;AACA,SAAQC,SAAR,EAAmBC,oBAAoB,IAAIC,iBAA3C,QAAmE,QAAnE;AACA,SAAQC,YAAR,QAA2B,gBAA3B;AACA,SAAQC,uBAAR,QAAsC,2BAAtC;AACA,SAAQC,GAAR,EAAaC,IAAb,EAAmBC,OAAnB,EAA4BC,OAA5B,EAAqCC,KAArC,EAA4CC,GAA5C,EAAiDC,GAAjD,EAAsDC,EAAtD,EAA0DC,OAA1D,EAAmEC,MAAnE,EAA2EC,GAA3E,QAAqF,WAArF;AAEA,IAAIC,CAAC,GAAG,CAAR;AAAA,IACIC,eAAe,GAAGX,IAAI,CAAC,IAAI,IAAIU,CAAT,CAAJ,GAAkBT,OADxC;AAAA,IAEIW,cAAc,GAAGd,uBAAuB,CAAC,CAAD,CAF5C;AAIA,OAAO,SAASe,UAAT,CAAoBC,CAApB,EAAuB;AAC5B,MAAIC,IAAI,GAAGJ,eAAe,GAAGJ,OAA7B;AAAA,MACIS,EAAE,GAAGnB,YAAY,CAACS,EAAD,EAAKS,IAAL,CAAZ,CAAuB,CAAvB,IAA4BlB,YAAY,CAAC,CAACS,EAAF,EAAMS,IAAN,CAAZ,CAAwB,CAAxB,CADrC;AAAA,MAEIE,EAAE,GAAGL,cAAc,CAAC,CAAD,EAAIG,IAAJ,CAAd,CAAwB,CAAxB,CAFT;AAAA,MAGIG,EAAE,GAAGrB,YAAY,CAAC,CAAD,EAAIkB,IAAJ,CAAZ,CAAsB,CAAtB,CAHT;AAAA,MAIII,GAAG,GAAGX,MAAM,GAAGU,EAJnB;AAAA,MAKIE,CAAC,GAAGX,GAAG,GAAGK,CALd;AAAA,MAMIO,CAAC,GAAG,IAAIZ,GANZ;AAAA,MAOIa,CAAC,GAAGL,EAAE,GAAIE,GAAG,GAAGA,GAAN,GAAY,CAAb,GAAkBV,GAP/B;;AASA,WAASc,OAAT,CAAiBC,MAAjB,EAAyBC,GAAzB,EAA8B;AAC5B,QAAIC,KAAJ;AAAA,QACIC,IAAI,GAAG5B,GAAG,CAAC0B,GAAD,CADd;;AAEA,QAAIE,IAAI,GAAGZ,IAAX,EAAiB;AACf,UAAIa,CAAC,GAAGvB,GAAG,CAACS,CAAC,GAAG,CAAL,EAAQV,GAAG,CAAC,CAAD,EAAID,KAAK,CAAC,CAACqB,MAAM,GAAGlB,EAAV,IAAgBc,CAAjB,CAAT,CAAX,CAAX;AACAI,MAAAA,MAAM,IAAIlB,EAAE,IAAIQ,CAAC,GAAG,CAAR,CAAF,GAAeA,CAAf,GAAmBc,CAAC,GAAGR,CAAjC;AACAM,MAAAA,KAAK,GAAG7B,YAAY,CAAC2B,MAAD,EAASG,IAAT,CAApB;AACAD,MAAAA,KAAK,CAAC,CAAD,CAAL,GAAWA,KAAK,CAAC,CAAD,CAAL,GAAWjB,GAAX,GAAiBO,EAAjB,GAAsBP,GAAG,IAAIK,CAAC,GAAG,CAAR,CAAH,IAAiB,IAAIA,CAArB,CAAtB,GAAgDc,CAAC,GAAGnB,GAAJ,GAAUK,CAArE;AACAY,MAAAA,KAAK,CAAC,CAAD,CAAL,GAAWT,EAAE,GAAG,CAACS,KAAK,CAAC,CAAD,CAAL,GAAWR,EAAZ,IAAkB,CAAlB,GAAsBC,GAAtB,GAA4BV,GAA5C;AACA,UAAIgB,GAAG,GAAG,CAAV,EAAaC,KAAK,CAAC,CAAD,CAAL,GAAW,CAACA,KAAK,CAAC,CAAD,CAAjB;AACd,KAPD,MAOO;AACLA,MAAAA,KAAK,GAAGd,cAAc,CAACY,MAAD,EAASC,GAAT,CAAtB;AACD;;AACDC,IAAAA,KAAK,CAAC,CAAD,CAAL,IAAYL,CAAZ,EAAeK,KAAK,CAAC,CAAD,CAAL,IAAYJ,CAA3B;AACA,WAAOI,KAAP;AACD;;AAEDH,EAAAA,OAAO,CAACM,MAAR,GAAiB,UAASC,CAAT,EAAYC,CAAZ,EAAe;AAC9BD,IAAAA,CAAC,IAAIT,CAAL,EAAQU,CAAC,IAAIT,CAAb;AACA,QAAIU,EAAE,GAAGjC,GAAG,CAACgC,CAAD,CAAZ;;AACA,QAAIC,EAAE,GAAGf,EAAT,EAAa;AACX,UAAIW,CAAC,GAAGvB,GAAG,CAACS,CAAC,GAAG,CAAL,EAAQV,GAAG,CAAC,CAAD,EAAID,KAAK,CAAC,CAAC2B,CAAC,GAAGxB,EAAL,IAAWc,CAAZ,CAAT,CAAX,CAAX;AACAU,MAAAA,CAAC,GAAG,CAACA,CAAC,GAAGxB,EAAE,IAAIQ,CAAC,GAAG,CAAR,CAAF,GAAeA,CAAnB,GAAuBc,CAAC,GAAGR,CAA5B,IAAiCJ,EAAjC,GAAsCP,GAA1C;AACA,UAAIiB,KAAK,GAAG7B,YAAY,CAACgC,MAAb,CAAoBC,CAApB,EAAuB,QAAQE,EAAE,GAAGf,EAAb,IAAmBR,GAAnB,GAAyBU,GAAzB,GAA+BD,EAAtD,CAAZ;AACAQ,MAAAA,KAAK,CAAC,CAAD,CAAL,IAAYpB,EAAE,IAAIQ,CAAC,GAAG,CAAR,CAAF,GAAeA,CAAf,GAAmBc,CAAC,GAAGR,CAAnC;AACA,UAAIW,CAAC,GAAG,CAAR,EAAWL,KAAK,CAAC,CAAD,CAAL,GAAW,CAACA,KAAK,CAAC,CAAD,CAAjB;AACX,aAAOA,KAAP;AACD;;AACD,WAAOd,cAAc,CAACiB,MAAf,CAAsBC,CAAtB,EAAyBC,CAAzB,CAAP;AACD,GAZD;;AAcA,SAAOR,OAAP;AACD;;AAED,SAASU,SAAT,CAAmBH,CAAnB,EAAsBF,CAAtB,EAAyB;AACvB,SAAO,CAACE,CAAD,EAAIF,CAAC,GAAG,CAAJ,GAAQ,KAAK1B,OAAb,GAAuBS,eAA3B,CAAP;AACD;;AAED,SAASuB,YAAT,CAAsBJ,CAAtB,EAAyBF,CAAzB,EAA4B;AAC1B,SAAO,CAACE,CAAD,EAAIF,CAAC,GAAG,CAAJ,GAAQ,CAAC,EAAD,GAAM1B,OAAd,GAAwB,CAACS,eAA7B,CAAP;AACD;;AAED,SAASwB,WAAT,CAAqBC,CAArB,EAAwB;AACtB,SAAO,CAACA,CAAC,CAAC,CAAD,CAAD,IAAQ,IAAIlC,OAAZ,CAAD,EAAuBkC,CAAC,CAAC,CAAD,CAAxB,CAAP;AACD;;AAED,SAASC,MAAT,CAAgBC,IAAhB,EAAsB;AACpB,MAAIC,CAAC,GAAG,GAAGC,MAAH,CACN/C,KAAK,CAAC,CAAC,GAAF,EAAO,MAAM6C,IAAI,GAAG,CAApB,EAAuBA,IAAvB,CAAL,CAAkCG,GAAlC,CAAsCR,SAAtC,CADM,EAENxC,KAAK,CAAC,GAAD,EAAM,CAAC,GAAD,GAAO6C,IAAI,GAAG,CAApB,EAAuB,CAACA,IAAxB,CAAL,CAAmCG,GAAnC,CAAuCP,YAAvC,CAFM,CAAR;AAIA,SAAO;AACLQ,IAAAA,IAAI,EAAE,SADD;AAELC,IAAAA,WAAW,EAAE,CAACL,IAAI,KAAK,GAAT,GAAeC,CAAC,CAACE,GAAF,CAAMN,WAAN,CAAf,GAAoCI,CAArC;AAFR,GAAP;AAID;;AAED,eAAe,YAAW;AACxB,MAAIzB,CAAC,GAAG,CAAR;AAAA,MACI8B,CAAC,GAAGhD,iBAAiB,CAACiB,UAAD,CADzB;AAAA,MAEIgC,CAAC,GAAGD,CAAC,CAAC9B,CAAD,CAFT;AAAA,MAGIgC,OAAO,GAAGD,CAAC,CAACE,MAHhB;;AAKAF,EAAAA,CAAC,CAACG,KAAF,GAAU,UAASC,CAAT,EAAY;AACpB,WAAOC,SAAS,CAACC,MAAV,GAAmBP,CAAC,CAAC9B,CAAC,GAAG,CAACmC,CAAN,CAApB,GAA+BnC,CAAtC;AACD,GAFD;;AAIA+B,EAAAA,CAAC,CAACE,MAAF,GAAW,UAASA,MAAT,EAAiB;AAC1B,QAAIK,MAAM,GAAGP,CAAC,CAACO,MAAF,EAAb;AAAA,QACIC,YAAY,GAAGP,OAAO,CAACC,MAAD,CAD1B;AAAA,QAEIO,YAAY,IAAIT,CAAC,CAACO,MAAF,CAAS,CAAC,CAAD,EAAI,CAAJ,CAAT,GAAkBN,OAAO,CAACC,MAAD,CAA7B,CAFhB;AAGAF,IAAAA,CAAC,CAACO,MAAF,CAASA,MAAT;;AACAC,IAAAA,YAAY,CAAChB,MAAb,GAAsB,YAAW;AAAE3C,MAAAA,SAAS,CAAC2C,MAAM,CAAC,MAAMvB,CAAP,CAAP,EAAkBwC,YAAlB,CAAT;AAA2C,KAA9E;;AACA,WAAOD,YAAP;AACD,GAPD;;AASA,SAAOR,CAAC,CACHU,KADE,CACI,MADJ,CAAP;AAED","sourcesContent":["import {range} from \"d3-array\";\nimport {geoStream, geoProjectionMutator as projectionMutator} from \"d3-geo\";\nimport {collignonRaw} from \"./collignon.js\";\nimport {cylindricalEqualAreaRaw} from \"./cylindricalEqualArea.js\";\nimport {abs, asin, degrees, epsilon, floor, max, min, pi, radians, sqrtPi, tau} from \"./math.js\";\n\nvar K = 3,\n    healpixParallel = asin(1 - 1 / K) * degrees,\n    healpixLambert = cylindricalEqualAreaRaw(0);\n\nexport function healpixRaw(H) {\n  var phi0 = healpixParallel * radians,\n      dx = collignonRaw(pi, phi0)[0] - collignonRaw(-pi, phi0)[0],\n      y0 = healpixLambert(0, phi0)[1],\n      y1 = collignonRaw(0, phi0)[1],\n      dy1 = sqrtPi - y1,\n      k = tau / H,\n      w = 4 / tau,\n      h = y0 + (dy1 * dy1 * 4) / tau;\n\n  function forward(lambda, phi) {\n    var point,\n        phi2 = abs(phi);\n    if (phi2 > phi0) {\n      var i = min(H - 1, max(0, floor((lambda + pi) / k)));\n      lambda += pi * (H - 1) / H - i * k;\n      point = collignonRaw(lambda, phi2);\n      point[0] = point[0] * tau / dx - tau * (H - 1) / (2 * H) + i * tau / H;\n      point[1] = y0 + (point[1] - y1) * 4 * dy1 / tau;\n      if (phi < 0) point[1] = -point[1];\n    } else {\n      point = healpixLambert(lambda, phi);\n    }\n    point[0] *= w, point[1] /= h;\n    return point;\n  }\n\n  forward.invert = function(x, y) {\n    x /= w, y *= h;\n    var y2 = abs(y);\n    if (y2 > y0) {\n      var i = min(H - 1, max(0, floor((x + pi) / k)));\n      x = (x + pi * (H - 1) / H - i * k) * dx / tau;\n      var point = collignonRaw.invert(x, 0.25 * (y2 - y0) * tau / dy1 + y1);\n      point[0] -= pi * (H - 1) / H - i * k;\n      if (y < 0) point[1] = -point[1];\n      return point;\n    }\n    return healpixLambert.invert(x, y);\n  };\n\n  return forward;\n}\n\nfunction sphereTop(x, i) {\n  return [x, i & 1 ? 90 - epsilon : healpixParallel];\n}\n\nfunction sphereBottom(x, i) {\n  return [x, i & 1 ? -90 + epsilon : -healpixParallel];\n}\n\nfunction sphereNudge(d) {\n  return [d[0] * (1 - epsilon), d[1]];\n}\n\nfunction sphere(step) {\n  var c = [].concat(\n    range(-180, 180 + step / 2, step).map(sphereTop),\n    range(180, -180 - step / 2, -step).map(sphereBottom)\n  );\n  return {\n    type: \"Polygon\",\n    coordinates: [step === 180 ? c.map(sphereNudge) : c]\n  };\n}\n\nexport default function() {\n  var H = 4,\n      m = projectionMutator(healpixRaw),\n      p = m(H),\n      stream_ = p.stream;\n\n  p.lobes = function(_) {\n    return arguments.length ? m(H = +_) : H;\n  };\n\n  p.stream = function(stream) {\n    var rotate = p.rotate(),\n        rotateStream = stream_(stream),\n        sphereStream = (p.rotate([0, 0]), stream_(stream));\n    p.rotate(rotate);\n    rotateStream.sphere = function() { geoStream(sphere(180 / H), sphereStream); };\n    return rotateStream;\n  };\n\n  return p\n      .scale(239.75);\n}\n"]},"metadata":{},"sourceType":"module"}