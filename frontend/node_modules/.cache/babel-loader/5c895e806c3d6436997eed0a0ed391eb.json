{"ast":null,"code":"/**\r\n * ExportMenu provides functionality for building Export menu\r\n */\nimport { __extends } from \"tslib\";\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\n\nimport exportCSS from \"./ExportCSS\";\nimport { Adapter } from \"../utils/Adapter\";\nimport { List } from \"../utils/List\";\nimport { getInteraction } from \"../interaction/Interaction\";\nimport { MutableValueDisposer } from \"../utils/Disposer\";\nimport { Language } from \"../utils/Language\";\nimport { Validatable } from \"../utils/Validatable\";\nimport { keyboard } from \"../utils/Keyboard\";\nimport * as $utils from \"../utils/Utils\";\nimport * as $iter from \"../utils/Iterator\";\nimport * as $dom from \"../utils/DOM\";\nimport * as $type from \"../utils/Type\";\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\n\n/**\r\n * Creates a menu for Export operations.\r\n *\r\n * To add an export menu to a chart, set this to a new instance of\r\n * [[ExportMenu]].\r\n *\r\n * ```TypeScript\r\n * chart.exporting.menu = new am4core.ExportMenu();\r\n * ```\r\n * ```JavaScript\r\n * chart.exporting.menu = new am4core.ExportMenu();\r\n * ```\r\n * ```JSON\r\n * {\r\n *   // ...\r\n *   \"exporting\": {\r\n *     \"menu\": {}\r\n *   }\r\n * }\r\n * ```\r\n * @important\r\n */\n\nvar ExportMenu =\n/** @class */\nfunction (_super) {\n  __extends(ExportMenu, _super);\n  /**\r\n   * Constructor\r\n   */\n\n\n  function ExportMenu() {\n    var _this = _super.call(this) || this;\n    /**\r\n     * An [[Adapter]].\r\n     */\n\n\n    _this.adapter = new Adapter(_this);\n    /**\r\n     * How many milliseconds to hold menu/sub-menu open after it loses focus or\r\n     * hover, before auto-closing it.\r\n     *\r\n     * @default 1000\r\n     */\n\n    _this.closeDelay = 1000;\n    /**\r\n     * Close the menu automatically when some export operation is triggered.\r\n     *\r\n     * @default true\r\n     * @since 4.2.2\r\n     */\n\n    _this.closeOnClick = true;\n    /**\r\n     * An instance of [[Language]].\r\n     */\n\n    _this._language = new MutableValueDisposer();\n    /**\r\n     * What HTML tags to use to build menu.\r\n     */\n\n    _this._menuTag = \"ul\";\n    /**\r\n     * Which tag to use to enclose individual menu items.\r\n     */\n\n    _this._itemTag = \"li\";\n    /**\r\n     * Tag to wrap menu item labels in.\r\n     */\n\n    _this._labelTag = \"a\";\n    /**\r\n     * Tag to use for icons\r\n     */\n\n    _this._iconTag = \"img\";\n    /**\r\n     * Prefix for class names applied to menu elements.\r\n     */\n\n    _this._classPrefix = \"amexport\";\n    /**\r\n     * If set to `true` [[ExportMenu]] will load it's own external CSS when\r\n     * instantiated.\r\n     */\n\n    _this._defaultStyles = true;\n    /**\r\n     * Horizontal positioning.\r\n     */\n\n    _this._align = \"right\";\n    /**\r\n     * Vertical positioning.\r\n     */\n\n    _this._verticalAlign = \"top\";\n    /**\r\n     * A tabindex to apply to Export Menu.\r\n     */\n\n    _this._tabindex = 0;\n    /**\r\n     * Whether next menu close event should be ignored.\r\n     */\n\n    _this._ignoreNextClose = false;\n    /**\r\n     * Default menu items.\r\n     */\n\n    _this._items = [{\n      \"label\": \"...\",\n      \"menu\": [{\n        \"label\": \"Image\",\n        \"menu\": [{\n          \"type\": \"png\",\n          \"label\": \"PNG\"\n        }, {\n          \"type\": \"jpg\",\n          \"label\": \"JPG\"\n        }, {\n          \"type\": \"svg\",\n          \"label\": \"SVG\"\n        }, {\n          \"type\": \"pdf\",\n          \"label\": \"PDF\"\n        }]\n      }, {\n        \"label\": \"Data\",\n        \"menu\": [{\n          \"type\": \"json\",\n          \"label\": \"JSON\"\n        }, {\n          \"type\": \"csv\",\n          \"label\": \"CSV\"\n        }, {\n          \"type\": \"xlsx\",\n          \"label\": \"XLSX\"\n        }, {\n          \"type\": \"html\",\n          \"label\": \"HTML\"\n        }, {\n          \"type\": \"pdfdata\",\n          \"label\": \"PDF\"\n        }]\n      }, {\n        \"label\": \"Print\",\n        \"type\": \"print\"\n      }]\n    }];\n    _this.className = \"ExportMenu\";\n\n    _this._disposers.push(_this._language);\n\n    _this.invalidate();\n\n    _this.applyTheme();\n\n    return _this;\n  }\n  /**\r\n   * (Re)draws the Export menu.\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n\n  ExportMenu.prototype.validate = function () {\n    this.draw();\n\n    _super.prototype.validate.call(this);\n  };\n  /**\r\n   * Draws the menu based on current items.\r\n   *\r\n   * Normally, there's no need to call this explicitly. The chart, if it has\r\n   * export menu enabled, will automatically draw the menu.\r\n   */\n\n\n  ExportMenu.prototype.draw = function () {\n    var _this = this; // Create top-level menu item, or clear it\n\n\n    if (!this._element) {\n      this._element = this.createMenuElement(0);\n    } else {\n      this._element.innerHTML = \"\";\n      this._element.className = this.getMenuItemClass(0);\n    } // See if we're loading external CSS\n    // Hide it until CSS is loaded\n\n\n    if (this.defaultStyles) {\n      this._element.style.display = \"none\";\n    } // Append to container\n\n\n    $type.getValue(this._container).appendChild(this._element); // Apply adapter to menu items before processing\n\n    var items = this.adapter.apply(\"items\", {\n      items: this._items\n    }).items;\n\n    for (var len = items.length, i = 0; i < len; i++) {\n      this.drawBranch(this._element, items[i], 0);\n    } // Apply adapter to finalized menu element\n\n\n    this._element = this.adapter.apply(\"menuElement\", {\n      menuElement: this._element\n    }).menuElement; // Set up global \"down\" event\n\n    this._disposers.push(getInteraction().body.events.on(\"down\", function (ev) {\n      if (!ev.pointer.touch) {\n        _this._ignoreNextClose = false;\n      }\n\n      _this.close();\n    })); // Set up global event on ESC press to close the menu\n\n\n    this._disposers.push(getInteraction().body.events.on(\"keyup\", function (ev) {\n      var key = keyboard.getEventKey(ev.event);\n\n      switch (key) {\n        case \"esc\":\n          _this.close();\n\n          break;\n\n        case \"up\":\n        case \"down\":\n        case \"left\":\n        case \"right\":\n          _this.moveSelection(key);\n\n          break;\n      }\n    }));\n\n    if (this.defaultStyles) {\n      this.loadDefaultCSS();\n    }\n  };\n  /**\r\n   * Creates a new branch in export menu. This function is recursive for\r\n   * building multi-level menus.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param container Container to put branch elements in\r\n   * @param branch    Menu item\r\n   * @param level     Current nesting level\r\n   */\n\n\n  ExportMenu.prototype.drawBranch = function (container, branch, level) {\n    var _this = this; // Apply adapter\n\n\n    branch = this.adapter.apply(\"branch\", {\n      branch: branch,\n      level: level\n    }).branch; // Unsupported?\n    // ExportMenu does not check or know for specific browser/system\n    // capabilities. It must happen in some other code and applied via Adapter.\n    // Export itself will check compatibility, but there might be other plugins\n    // that influence it or even add any specific export functionality.\n\n    if (branch.unsupported === true) {\n      return;\n    } // Init ascendants\n\n\n    if (!branch.ascendants) {\n      branch.ascendants = new List();\n    } // Get type\n\n\n    var type = branch.type; // Create an item\n\n    var element = this.createItemElement(level, type); // Create label\n\n    var label; // Create icon\n\n    if (branch.icon) {\n      label = this.createIconElement(level, type);\n      label.src = branch.icon;\n\n      if (branch.label) {\n        label.title = branch.label;\n      }\n    } else if (branch.svg) {\n      label = this.createSvgElement(level, type, branch.svg);\n\n      if (branch.label) {\n        label.title = branch.label;\n      }\n    } else {\n      label = this.createLabelElement(level, type);\n      label.innerHTML = branch.label ? this.language.translate(branch.label) : \"\";\n    } // Apply reader text to label\n\n\n    var readerLabel = this.getReaderLabel(branch, label.innerHTML);\n    label.setAttribute(\"aria-label\", readerLabel); // Add Label\n\n    element.appendChild(label); // Create interaction object\n    // TODO clean this up when it's disposed\n\n    branch.interactions = getInteraction().getInteraction(label);\n    branch.element = element; // Create interaction manager we can set event listeners to\n\n    if (this.typeClickable(type)) {\n      //branch.interactions.clickable = true;\n      // TODO clean this up when it's disposed\n      branch.interactions.events.on(\"hit\", function (ev) {\n        if (_this.events.isEnabled(\"hit\")) {\n          var event_1 = {\n            \"type\": \"hit\",\n            \"event\": ev.event,\n            \"target\": _this,\n            \"branch\": branch\n          };\n\n          _this.events.dispatchImmediately(\"hit\", event_1);\n        }\n      }); // TODO clean this up when it's disposed\n\n      branch.interactions.events.on(\"keyup\", function (ev) {\n        if (keyboard.isKey(ev.event, \"enter\")) {\n          if (_this.events.isEnabled(\"enter\")) {\n            var event_2 = {\n              \"type\": \"enter\",\n              \"event\": ev.event,\n              \"target\": _this,\n              \"branch\": branch\n            };\n\n            _this.events.dispatchImmediately(\"enter\", event_2);\n          }\n        }\n      });\n    }\n\n    {\n      var submenu_1 = this.getSubMenu(branch); // Add ENTER event to open sub-menus\n\n      if (submenu_1 != null) {\n        // TODO clean this up when it's disposed\n        branch.interactions.events.on(\"keyup\", function (ev) {\n          if (keyboard.isKey(ev.event, \"enter\")) {\n            // This is item has sub-menu, activate the first child on ENTER\n            _this.selectBranch(submenu_1[0]); // Attempt to set focus\n\n\n            _this.setFocus(submenu_1[0]);\n          }\n        });\n        branch.interactions.events.on(\"hit\", function (ev) {\n          _this.selectBranch(branch);\n        });\n      }\n    } // Add events\n    // TODO clean this up when it's disposed\n\n    branch.interactions.events.on(\"over\", function (ev) {\n      if (ev.pointer.touch) {\n        // Cancel pending menu closure\n        _this._ignoreNextClose = true;\n      }\n\n      _this.selectBranch(branch);\n\n      if (_this.events.isEnabled(\"over\")) {\n        var event_3 = {\n          \"type\": \"over\",\n          \"event\": ev.event,\n          \"target\": _this,\n          \"branch\": branch\n        };\n\n        _this.events.dispatchImmediately(\"over\", event_3);\n      }\n    }); // TODO clean this up when it's disposed\n\n    branch.interactions.events.on(\"out\", function (ev) {\n      if (!ev.pointer.touch) {\n        _this.delayUnselectBranch(branch);\n      }\n\n      if (_this.events.isEnabled(\"out\")) {\n        var event_4 = {\n          \"type\": \"out\",\n          \"event\": ev.event,\n          \"target\": _this,\n          \"branch\": branch\n        };\n\n        _this.events.dispatchImmediately(\"out\", event_4);\n      }\n    }); // TODO clean this up when it's disposed\n\n    branch.interactions.events.on(\"focus\", function (ev) {\n      _this.selectBranch(branch);\n    }); // TODO clean this up when it's disposed\n\n    branch.interactions.events.on(\"blur\", function (ev) {\n      _this.delayUnselectBranch(branch);\n    }); // Increment level\n\n    var local_level = level + 1; // Has sub-menu?\n\n    if (branch.menu) {\n      var submenu = this.createMenuElement(local_level);\n\n      for (var len = branch.menu.length, i = 0; i < len; i++) {\n        var ascendants = new List();\n        branch.menu[i].ascendants = ascendants;\n\n        if (branch.ascendants.length) {\n          ascendants.copyFrom(branch.ascendants);\n        }\n\n        ascendants.push(branch);\n        this.drawBranch(submenu, branch.menu[i], local_level);\n      } // Sub-menu is empty (all items are not supported)\n      // Do not draw this menu item at all\n\n\n      if (submenu.innerHTML == \"\") {\n        return;\n      }\n\n      element.appendChild(submenu);\n    } // Should this item be hidden?\n\n\n    if (branch.hidden) {\n      this.hideBranch(branch);\n    } // Add id?\n\n\n    if (branch.id) {\n      element.setAttribute(\"id\", branch.id);\n    } // Background color?\n\n\n    if (branch.color) {\n      element.style.backgroundColor = branch.color.hex;\n    } // Append to container\n\n\n    container.appendChild(element);\n  };\n  /**\r\n   * Creates a menu element to hold its elements in. Usually it's an `<ul>`\r\n   * tag.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param level  Current nesting level\r\n   * @return HTML element reference\r\n   */\n\n\n  ExportMenu.prototype.createMenuElement = function (level) {\n    var element = document.createElement(this.menuTag);\n    element.className = this.getMenuItemClass(level); // Accessibility\n\n    if (level === 0) {\n      element.setAttribute(\"role\", \"menu\");\n    }\n\n    return element;\n  };\n  /**\r\n   * Generates a class name for the menu element based on its nesting level.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param level  Current nesting level\r\n   * @return Class name(s)\r\n   */\n\n\n  ExportMenu.prototype.getMenuItemClass = function (level) {\n    var className = this.classPrefix + \"-menu \" + this.classPrefix + \"-menu-level-\" + level;\n\n    if (level === 0) {\n      className += \" \" + this.classPrefix + \"-menu-root \" + this.classPrefix + \"-\" + this.align + \" \" + this.classPrefix + \"-\" + this.verticalAlign;\n    }\n\n    return this.adapter.apply(\"menuClass\", {\n      className: className,\n      level: level\n    }).className;\n  };\n  /**\r\n   * Creates menu item. Usually `<li>` tag. Its label and sub-elements will go\r\n   * into this element.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param level  Current nesting level\r\n   * @param type   Type of the menu item\r\n   * @return HTML element reference\r\n   */\n\n\n  ExportMenu.prototype.createItemElement = function (level, type) {\n    var element = document.createElement(this.itemTag);\n    var className = this.classPrefix + \"-item \" + this.classPrefix + \"-item-level-\" + level + \" \" + this.classPrefix + \"-item-\" + (type || \"blank\");\n    element.className = this.adapter.apply(\"itemClass\", {\n      className: className,\n      level: level,\n      type: type\n    }).className;\n    element.setAttribute(\"role\", \"menuitem\");\n    return element;\n  };\n  /**\r\n   * Creates a \"label\" part of the menu item. It could be text or any HTML\r\n   * content.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param level  Current nesting level\r\n   * @param type   Type of the menu item\r\n   * @return An HTML Element\r\n   */\n\n\n  ExportMenu.prototype.createLabelElement = function (level, type) {\n    var element = document.createElement(this.labelTag);\n    var className = this.classPrefix + \"-label \" + this.classPrefix + \"-label-level-\" + level + \" \" + this.classPrefix + \"-item-\" + (type || \"blank\");\n\n    if (this.typeClickable(type)) {\n      className += \" \" + this.classPrefix + \"-clickable\";\n    }\n\n    element.className = this.adapter.apply(\"labelClass\", {\n      className: className,\n      level: level,\n      type: type\n    }).className; // Accessible navigation\n\n    element.setAttribute(\"tabindex\", this.tabindex.toString());\n    element.setAttribute(\"role\", \"menuitem\");\n    return element;\n  };\n  /**\r\n   * Creates a \"icon\" part of the menu item.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param level  Current nesting level\r\n   * @param type   Type of the menu item\r\n   * @return An HTML Element\r\n   */\n\n\n  ExportMenu.prototype.createIconElement = function (level, type) {\n    var element = document.createElement(this.iconTag);\n    var className = this.classPrefix + \"-icon \" + this.classPrefix + \"-icon-level-\" + level + \" \" + this.classPrefix + \"-item-\" + (type || \"blank\");\n\n    if (this.typeClickable(type)) {\n      className += \" \" + this.classPrefix + \"-clickable\";\n    }\n\n    element.className = this.adapter.apply(\"labelClass\", {\n      className: className,\n      level: level,\n      type: type\n    }).className; // Accessible navigation\n\n    element.setAttribute(\"tabindex\", this.tabindex.toString());\n    element.setAttribute(\"role\", \"menuitem\");\n    return element;\n  };\n  /**\r\n   * Creates a a custom element out of raw HTML.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param level  Current nesting level\r\n   * @param type   Type of the menu item\r\n   * @return An HTML Element\r\n   */\n\n\n  ExportMenu.prototype.createSvgElement = function (level, type, svg) {\n    var parser = new DOMParser();\n    var element = parser.parseFromString(svg, \"image/svg+xml\").documentElement;\n    var className = this.classPrefix + \"-icon \" + this.classPrefix + \"-icon-level-\" + level + \" \" + this.classPrefix + \"-item-\" + (type || \"blank\");\n\n    if (this.typeClickable(type)) {\n      className += \" \" + this.classPrefix + \"-clickable\";\n    }\n\n    element.setAttribute(\"class\", this.adapter.apply(\"labelClass\", {\n      className: className,\n      level: level,\n      type: type\n    }).className); // Accessible navigation\n\n    element.setAttribute(\"tabindex\", this.tabindex.toString());\n    element.setAttribute(\"role\", \"menuitem\");\n    return element;\n  };\n  /**\r\n   * Destroys the menu and all its elements.\r\n   */\n\n\n  ExportMenu.prototype.dispose = function () {\n    if (!this._disposed) {\n      _super.prototype.dispose.call(this);\n\n      if (this._element && this._element.parentNode) {\n        this._element.parentNode.removeChild(this._element);\n      }\n    }\n  };\n  /**\r\n   * Checks whether menu item type is supposed to be clickable.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param type  Menu item type\r\n   * @return Is clickable?\r\n   */\n\n\n  ExportMenu.prototype.typeClickable = function (type) {\n    return $type.hasValue(type);\n  };\n  /**\r\n   * Checks whether menu item has any sub-items.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param branch  A menu item\r\n   * @return Has sub-items?\r\n   */\n\n\n  ExportMenu.prototype.hasSubMenu = function (branch) {\n    return branch.menu && branch.menu.length ? true : false;\n  };\n  /**\r\n   * Returns sub-items (if they exist).\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param branch  A menu item\r\n   * @return Submenus\r\n   */\n\n\n  ExportMenu.prototype.getSubMenu = function (branch) {\n    if (branch.menu && branch.menu.length) {\n      return branch.menu;\n    }\n  };\n  /**\r\n   * Generates and returns an applicable label to be used for screen readers.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param item   A menu item instance\r\n   * @param label  Current label\r\n   * @return Reader text\r\n   */\n\n\n  ExportMenu.prototype.getReaderLabel = function (branch, label) {\n    // Strip any HTML from the label\n    label = $utils.stripTags(label); // Add textual note if the branch is clickable\n\n    if (this.hasSubMenu(branch)) {\n      label += \" [\" + this.language.translate(\"Click, tap or press ENTER to open\") + \"]\";\n    } else if (branch.type == \"print\") {\n      label = this.language.translate(\"Click, tap or press ENTER to print.\");\n    } else if (this.typeClickable(branch.type)) {\n      label = this.language.translate(\"Click, tap or press ENTER to export as %1.\", undefined, label);\n    }\n\n    return this.adapter.apply(\"rederLabel\", {\n      label: label,\n      branch: branch\n    }).label;\n  };\n\n  Object.defineProperty(ExportMenu.prototype, \"container\", {\n    /**\r\n     * @return Container\r\n     */\n    get: function get() {\n      return this._container;\n    },\n\n    /**\r\n     * Getters and setters\r\n     */\n\n    /**\r\n     * An HTML container to place the Menu in.\r\n     *\r\n     * A container must be an HTML element, because menu itself is HTML, and\r\n     * cannot be placed into SVG.\r\n     *\r\n     * @param container Reference to container element\r\n     * @todo Check if menu is already build. If it is, just move it to a new container\r\n     */\n    set: function set(container) {\n      this._container = container;\n      this.invalidate();\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ExportMenu.prototype, \"items\", {\n    /**\r\n     * @return Menu items\r\n     */\n    get: function get() {\n      return this._items;\n    },\n\n    /**\r\n     * A list of menu items. Can be nested.\r\n     *\r\n     * @param items  Menu items\r\n     */\n    set: function set(items) {\n      this._items = items;\n      this.invalidate();\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ExportMenu.prototype, \"tag\", {\n    /**\r\n     * Sets main menu tag to place menu in.\r\n     *\r\n     * This also sets up how menu items are built.\r\n     *\r\n     * If you set this to \"ul\", menu items will be wrapped into `<li>` tags.\r\n     *\r\n     * If set to \"div\", menu items will be wrapped in `<div>` tags.\r\n     *\r\n     * @default \"ul\"\r\n     * @param tag Tag to use for menu\r\n     */\n    set: function set(tag) {\n      this._menuTag = tag;\n      this._itemTag = tag == \"ul\" ? \"li\" : \"div\";\n      this.invalidate();\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ExportMenu.prototype, \"menuTag\", {\n    /**\r\n     * Returns current menu tag.\r\n     *\r\n     * @ignore Exclude from docs\r\n     * @return Menu tag (item that contains sub-items)\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"menuTag\", {\n        tag: this._menuTag\n      }).tag;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ExportMenu.prototype, \"itemTag\", {\n    /**\r\n     * Returns tag to wrap items into.\r\n     *\r\n     * @ignore Exclude from docs\r\n     * @return Item tag\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"itemTag\", {\n        tag: this._itemTag\n      }).tag;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ExportMenu.prototype, \"labelTag\", {\n    /**\r\n     * Returns menu label tag.\r\n     *\r\n     * @ignore Exclude from docs\r\n     * @return Label tag\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"labelTag\", {\n        tag: this._labelTag\n      }).tag;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ExportMenu.prototype, \"iconTag\", {\n    /**\r\n     * Returns icon tag.\r\n     *\r\n     * @ignore Exclude from docs\r\n     * @return Icon tag\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"iconTag\", {\n        tag: this._iconTag\n      }).tag;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ExportMenu.prototype, \"align\", {\n    /**\r\n     * @return Horizontal alignment\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"align\", {\n        align: this._align\n      }).align;\n    },\n\n    /**\r\n     * A horizontal alignment for the menu placement.\r\n     *\r\n     * @param value Horizontal alignment\r\n     */\n    set: function set(value) {\n      this._align = value;\n      this.invalidate();\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ExportMenu.prototype, \"verticalAlign\", {\n    /**\r\n     * @return Vertical alignment\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"verticalAlign\", {\n        verticalAlign: this._verticalAlign\n      }).verticalAlign;\n    },\n\n    /**\r\n     * A vertical alignment for the menu placement.\r\n     *\r\n     * @param value Vertical alignment\r\n     */\n    set: function set(value) {\n      this._verticalAlign = value;\n      this.invalidate();\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ExportMenu.prototype, \"classPrefix\", {\n    /**\r\n     * @return Class name prefix\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"classPrefix\", {\n        classPrefix: this._classPrefix\n      }).classPrefix;\n    },\n\n    /**\r\n     * Class name prefix.\r\n     *\r\n     * @default \"amexport\"\r\n     * @param value Class name prefix\r\n     */\n    set: function set(value) {\n      this._classPrefix = value;\n      this.invalidate();\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ExportMenu.prototype, \"defaultStyles\", {\n    /**\r\n     * @return Should ExportMenu load its own CSS?\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"defaultStyles\", {\n        defaultStyles: this._defaultStyles\n      }).defaultStyles;\n    },\n\n    /**\r\n     * Indicates whether [[ExportMenu]] should load external CSS to style itself.\r\n     *\r\n     * If set to `false`, the menu will not be styled, and will rely on some\r\n     * external CSS.\r\n     *\r\n     * @default true\r\n     * @param Should ExportMenu load its own CSS?\r\n     */\n    set: function set(value) {\n      if (this._defaultStyles != value) {\n        this._defaultStyles = value;\n\n        if (value) {\n          this.loadDefaultCSS();\n        }\n      }\n\n      this.invalidate();\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Loads the default CSS.\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n  ExportMenu.prototype.loadDefaultCSS = function () {\n    this._disposers.push(exportCSS($dom.getShadowRoot(this.container), this.classPrefix));\n\n    if (this._element) {\n      this._element.style.display = \"\";\n    }\n  };\n\n  Object.defineProperty(ExportMenu.prototype, \"tabindex\", {\n    /**\r\n     * @return Tab index\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"tabindex\", {\n        tabindex: this._tabindex\n      }).tabindex;\n    },\n\n    /**\r\n     * A tab index for the menu.\r\n     *\r\n     * Tab index will influence the order in which elements on the chart and\r\n     * the whole page are selected when pressing TAB key.\r\n     *\r\n     * @param value Tab index\r\n     */\n    set: function set(value) {\n      this._tabindex = value;\n      this.invalidate();\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ExportMenu.prototype, \"language\", {\n    /**\r\n     * @return A [[Language]] instance to be used\r\n     */\n    get: function get() {\n      var _this = this;\n\n      var language = this._language.get();\n\n      if (language == null) {\n        language = new Language(); // TODO code duplication with `set language()`\n\n        this._language.set(language, language.events.on(\"localechanged\", function (ev) {\n          _this.invalidate();\n        }));\n      }\n\n      return language;\n    },\n\n    /**\r\n     * A [[Language]] instance.\r\n     *\r\n     * @param value An instance of [[Language]]\r\n     */\n    set: function set(value) {\n      var _this = this;\n\n      this._language.set(value, value.events.on(\"localechanged\", function (ev) {\n        _this.invalidate();\n      }));\n\n      this.invalidate();\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Controlling the menu\r\n   */\n\n  /**\r\n   * Removes all active classes from menu items. Useful on touch devices and\r\n   * keyboard navigation where open menu can be closed instantly by clicking or\r\n   * tapping outside it.\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n  ExportMenu.prototype.close = function () {\n    var _this = this;\n\n    if (this._ignoreNextClose) {\n      this._ignoreNextClose = false;\n      return;\n    }\n\n    if (this.closeOnClick) {\n      this._element.style.pointerEvents = \"none\";\n      setTimeout(function () {\n        _this._element.style.pointerEvents = \"auto\";\n      }, 100);\n    }\n\n    if (this._currentSelection) {\n      this.setBlur(this._currentSelection);\n      this._currentSelection = undefined;\n    }\n\n    if (this._element) {\n      var items = this._element.getElementsByClassName(\"active\");\n\n      for (var len = items.length, i = len - 1; i >= 0; i--) {\n        if (items[i]) {\n          $dom.removeClass(items[i], \"active\");\n        }\n      }\n    }\n\n    this.events.dispatchImmediately(\"closed\", {\n      type: \"closed\",\n      target: this\n    });\n  };\n  /**\r\n   * Selects a branch in the menu.\r\n   *\r\n   * Handles closing of currently open branch.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param branch Branch to select\r\n   */\n\n\n  ExportMenu.prototype.selectBranch = function (branch) {\n    var _this = this; // Cancel previous closure\n\n\n    if (branch.closeTimeout) {\n      this.removeDispose(branch.closeTimeout);\n      branch.closeTimeout = undefined;\n    } // Add active class\n\n\n    $dom.addClass(branch.interactions.element.parentElement, \"active\"); // Remove current selection\n\n    if (this._currentSelection && this._currentSelection !== branch && this._currentSelection.ascendants) {\n      $iter.each($iter.concat($iter.fromArray([this._currentSelection]), this._currentSelection.ascendants.iterator()), function (ascendant) {\n        if (!branch.ascendants.contains(ascendant) && branch !== ascendant) {\n          _this.unselectBranch(ascendant, true);\n        }\n      });\n    } // Select and/or cancel timeout for current ascendants\n\n\n    $iter.each(branch.ascendants.iterator(), function (ascendant) {\n      if (ascendant.closeTimeout) {\n        _this.removeDispose(ascendant.closeTimeout);\n\n        ascendant.closeTimeout = undefined;\n      }\n\n      $dom.addClass(ascendant.interactions.element.parentElement, \"active\");\n    }); // Log current selection\n\n    this._currentSelection = branch; // Invoke event\n\n    if (this.events.isEnabled(\"branchselected\")) {\n      var event_5 = {\n        type: \"branchselected\",\n        target: this,\n        branch: branch\n      };\n      this.events.dispatchImmediately(\"branchselected\", event_5);\n    }\n  };\n  /**\r\n   * Unselects a branch. Also selects a branch one level up if necessary.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param branch Branch to unselect\r\n   * @param simple If `true`, only the branch will be unselected without selecting parent branch\r\n   */\n\n\n  ExportMenu.prototype.unselectBranch = function (branch, simple) {\n    // Remove active class\n    $dom.removeClass(branch.interactions.element.parentElement, \"active\"); // Remove current selection\n\n    if (this._currentSelection == branch) {\n      this._currentSelection = undefined;\n    } // Invoke event\n\n\n    if (this.events.isEnabled(\"branchunselected\")) {\n      var event_6 = {\n        type: \"branchunselected\",\n        target: this,\n        branch: branch\n      };\n      this.events.dispatchImmediately(\"branchunselected\", event_6);\n    }\n  };\n  /**\r\n   * Delay unselection of a branch. This can still be cancelled in some other\r\n   * place if the branch or its children regain focus.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param branch Branch to unselect\r\n   * @param simple If `true`, only the branch will be unselected without selecting parent branch\r\n   */\n\n\n  ExportMenu.prototype.delayUnselectBranch = function (branch, simple) {\n    var _this = this; // Schedule branch unselection\n\n\n    if (branch.closeTimeout) {\n      this.removeDispose(branch.closeTimeout);\n      branch.closeTimeout = undefined;\n    }\n\n    branch.closeTimeout = this.setTimeout(function () {\n      _this.unselectBranch(branch, simple);\n    }, this.closeDelay); // Schedule unselection of all ascendants\n    // In case focus went away from the export menu altogether, this will ensure\n    // that all items will be closed.\n    // In case we're jumping to other menu item, those delayed unselections will\n    // be cancelled by `selectBranch`\n\n    if (simple !== true && branch.ascendants) {\n      $iter.each(branch.ascendants.iterator(), function (ascendant) {\n        _this.delayUnselectBranch(ascendant, true);\n      });\n    }\n  };\n  /**\r\n   * Navigates the menu based on which direction kayboard key was pressed.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param key A key that was pressed\r\n   */\n\n\n  ExportMenu.prototype.moveSelection = function (key) {\n    // Check if there's a current selection\n    if (!this._currentSelection) {\n      return;\n    }\n\n    var newSelection;\n\n    if (key == \"up\") {\n      // Try moving up in current menu list, or to the last item if already\n      // at the top\n      newSelection = this.getPrevSibling(this._currentSelection);\n    } else if (key == \"down\") {\n      // Try moving down in current menu list, or to the top item if already\n      // at the bottom\n      newSelection = this.getNextSibling(this._currentSelection);\n    } else if (key == \"left\" && this.align == \"right\" || key == \"right\" && this.align == \"left\") {\n      var menu = this.getSubMenu(this._currentSelection); // Go one level-deeper\n\n      if (menu != null) {\n        newSelection = menu[0];\n      }\n    } else if (key == \"right\" && this.align == \"right\" || key == \"left\" && this.align == \"left\") {\n      // Go one level-deeper\n      newSelection = this.getParentItem(this._currentSelection);\n    }\n\n    if (newSelection && newSelection !== this._currentSelection) {\n      this.selectBranch(newSelection);\n      this.setFocus(newSelection);\n      this._currentSelection = newSelection;\n    }\n  };\n  /**\r\n   * Returns all siblings of a menu item, including this same menu item.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param branch  Menu item\r\n   * @return List of sibling menu items\r\n   */\n\n\n  ExportMenu.prototype.getSiblings = function (branch) {\n    var parent = this.getParentItem(branch);\n\n    if (parent && parent.menu) {\n      return parent.menu;\n    } else {\n      return [];\n    }\n  };\n  /**\r\n   * Returns menu items parent item.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param branch  Menu item\r\n   * @return Parent menu item\r\n   */\n\n\n  ExportMenu.prototype.getParentItem = function (branch) {\n    if (branch.ascendants && branch.ascendants.length) {\n      return branch.ascendants.getIndex(branch.ascendants.length - 1);\n    } else {\n      return undefined;\n    }\n  };\n  /**\r\n   * Returns next sibling in the same menu branch. If there is no next sibling,\r\n   * the first one is returned. If there is just one item, that item is\r\n   * returned. Unsupported menu items are skipped.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param branch  Menu item to search siblings for\r\n   * @return Menu item\r\n   */\n\n\n  ExportMenu.prototype.getNextSibling = function (branch) {\n    var siblings = this.getSiblings(branch);\n\n    if (siblings.length > 1) {\n      var next = siblings.indexOf(branch) + 1;\n      next = siblings.length == next ? 0 : next;\n      return siblings[next].unsupported ? this.getNextSibling(siblings[next]) : siblings[next];\n    } else {\n      return branch;\n    }\n  };\n  /**\r\n   * Returns previous sibling in the same menu branch. If there is no next\r\n   * sibling, the first one is returned. If there is just one item, that item is\r\n   * returned. Unsupported menu items are skipped.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param branch  Menu item to search siblings for\r\n   * @return Menu item\r\n   */\n\n\n  ExportMenu.prototype.getPrevSibling = function (branch) {\n    var siblings = this.getSiblings(branch);\n\n    if (siblings.length > 1) {\n      var prev = siblings.indexOf(branch) - 1;\n      prev = prev == -1 ? siblings.length - 1 : prev;\n      return siblings[prev].unsupported ? this.getPrevSibling(siblings[prev]) : siblings[prev];\n    } else {\n      return branch;\n    }\n  };\n  /**\r\n   * Attempts to set focus on particular menu element.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param branch Menu item\r\n   */\n\n\n  ExportMenu.prototype.setFocus = function (branch) {\n    if (branch.interactions) {\n      try {\n        branch.interactions.element.focus();\n      } catch (e) {// nothing\n      }\n    }\n  };\n  /**\r\n   * Attempts to remove focus from the menu element.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param branch Menu item\r\n   */\n\n\n  ExportMenu.prototype.setBlur = function (branch) {\n    if (branch.interactions) {\n      try {\n        branch.interactions.element.blur();\n      } catch (e) {// nothing\n      }\n    }\n  };\n  /**\r\n   * Hides the whole branch of menu.\r\n   *\r\n   * @param  branch  branch\r\n   */\n\n\n  ExportMenu.prototype.hideBranch = function (branch) {\n    branch.element.style.display = \"none\";\n  };\n  /**\r\n   * Show the branch of menu.\r\n   *\r\n   * @param  branch  branch\r\n   */\n\n\n  ExportMenu.prototype.showBranch = function (branch) {\n    branch.element.style.display = \"\";\n  };\n\n  return ExportMenu;\n}(Validatable);\n\nexport { ExportMenu };","map":{"version":3,"sources":["../../../../../src/.internal/core/export/ExportMenu.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * ExportMenu provides functionality for building Export menu\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport exportCSS from \"./ExportCSS\";\r\nimport { IExportOptions } from \"./Export\";\r\nimport { Adapter } from \"../utils/Adapter\";\r\nimport { List } from \"../utils/List\";\r\nimport { Align } from \"../defs/Align\";\r\nimport { VerticalAlign } from \"../defs/VerticalAlign\";\r\nimport { getInteraction } from \"../interaction/Interaction\";\r\nimport { InteractionObject } from \"../interaction/InteractionObject\";\r\nimport { AMEvent } from \"../utils/EventDispatcher\";\r\nimport { IDisposer, MutableValueDisposer } from \"../utils/Disposer\";\r\nimport { Language, ILocaleProperties } from \"../utils/Language\";\r\nimport { Validatable } from \"../utils/Validatable\";\r\nimport { keyboard, KeyboardKeys } from \"../utils/Keyboard\";\r\nimport { Color } from \"../utils/Color\";\r\nimport * as $utils from \"../utils/Utils\";\r\nimport * as $iter from \"../utils/Iterator\";\r\nimport * as $dom from \"../utils/DOM\";\r\nimport * as $type from \"../utils/Type\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Export menu item interface.\r\n */\r\nexport interface IExportMenuItem {\r\n\r\n\t/**\r\n\t * Item type, usually an export format.\r\n\t */\r\n\ttype?: keyof IExportOptions;\r\n\r\n\t/**\r\n\t * Label to display in the menu.\r\n\t */\r\n\tlabel?: string;\r\n\r\n\t/**\r\n\t * A `href` of the image to show instead of a label.\r\n\t */\r\n\ticon?: string;\r\n\r\n\t/**\r\n\t * Raw SVG content to add to instead of regular label.\r\n\t */\r\n\tsvg?: string;\r\n\r\n\t/**\r\n\t * Export format. (optional)\r\n\t */\r\n\tformat?: string;\r\n\r\n\t/**\r\n\t * Menu item options.\r\n\t *\r\n\t * @see {@link IExportOptions}\r\n\t */\r\n\toptions?: IExportOptions[keyof IExportOptions];\r\n\r\n\t/**\r\n\t * Priority.\r\n\t *\r\n\t * The items in Export menu will be sorted by their priority in ascending\r\n\t * order.\r\n\t *\r\n\t * @ignore Exclude from docs (this feature is not yet implemented)\r\n\t */\r\n\tpriority?: number;\r\n\r\n\t/**\r\n\t * An array of [[IExportMenuItem]] items, to construct a sub-menu out of.\r\n\t *\r\n\t * An Export menu can have any number of nesting levels.\r\n\t */\r\n\tmenu?: Array<IExportMenuItem>;\r\n\r\n\t/**\r\n\t * If this is set to true, it means that this specific menu item is not\r\n\t * supported by the current client system.\r\n\t *\r\n\t * This is usually populated by [[Export]]'s `supported` Adapter.\r\n\t *\r\n\t * @see {@link IExportAdapters}\r\n\t */\r\n\tunsupported?: boolean\r\n\r\n\t/**\r\n\t * An [[InteractionObject]] representation of the menu item label.\r\n\t */\r\n\tinteractions?: InteractionObject;\r\n\r\n\t/**\r\n\t * Actual HTML element of the menu item.\r\n\t */\r\n\telement?: HTMLElement;\r\n\r\n\t/**\r\n\t * Holds list of parent menu items to this item.\r\n\t */\r\n\tascendants?: List<IExportMenuItem>;\r\n\r\n\t/**\r\n\t * Holds timeout reference.\r\n\t *\r\n\t * Used to delay auto-closing of the menu when it is no longer hovered.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tcloseTimeout?: IDisposer;\r\n\r\n\t/**\r\n\t * Should this item be hidden?\r\n\t */\r\n\thidden?: boolean;\r\n\r\n\t/**\r\n\t * A unique id to attach to the menu item.\r\n\t */\r\n\tid?: string;\r\n\r\n\t/**\r\n\t * Color to use as a background.\r\n\t */\r\n\tcolor?: Color;\r\n\r\n}\r\n\r\n/**\r\n * Defines [[ExportMenu]] events.\r\n */\r\nexport interface IExportMenuEvents {\r\n\r\n\t/**\r\n\t * Invoked when menu item is clicked/tapped.\r\n\t */\r\n\thit: {\r\n\t\tbranch: IExportMenuItem;\r\n\t\tevent: MouseEvent | TouchEvent;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when menu item is hovered.\r\n\t */\r\n\tover: {\r\n\t\tbranch: IExportMenuItem;\r\n\t\tevent: MouseEvent | TouchEvent;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when menu item is no longer hovered.\r\n\t */\r\n\tout: {\r\n\t\tbranch: IExportMenuItem;\r\n\t\tevent: MouseEvent | TouchEvent;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when ENTER key is pressed when certain menu item is in focus.\r\n\t */\r\n\tenter: {\r\n\t\tbranch: IExportMenuItem;\r\n\t\tevent: KeyboardEvent;\r\n\t}\r\n\r\n\t/**\r\n\t * Invoked when menu branch is selected. (either by hover or keyboard)\r\n\t */\r\n\tbranchselected: {\r\n\t\tbranch: IExportMenuItem;\r\n\t}\r\n\r\n\t/**\r\n\t * Invoked when menu branch is unselected.\r\n\t */\r\n\tbranchunselected: {\r\n\t\tbranch: IExportMenuItem;\r\n\t}\r\n\r\n\t/**\r\n\t * Invoked when menu is closed.\r\n\t */\r\n\tclosed: {};\r\n\r\n}\r\n\r\n/**\r\n * Represents a list of available adapters for Export\r\n */\r\nexport interface IExportMenuAdapters {\r\n\r\n\titems: {\r\n\t\titems: Array<IExportMenuItem>\r\n\t},\r\n\r\n\tmenuElement: {\r\n\t\tmenuElement: HTMLElement\r\n\t},\r\n\r\n\tbranch: {\r\n\t\tbranch: IExportMenuItem,\r\n\t\tlevel: number\r\n\t},\r\n\r\n\trederLabel: {\r\n\t\tlabel: string,\r\n\t\tbranch: IExportMenuItem\r\n\t},\r\n\r\n\tmenuClass: {\r\n\t\tclassName: string,\r\n\t\tlevel: number\r\n\t},\r\n\r\n\titemClass: {\r\n\t\tclassName: string,\r\n\t\tlevel: number,\r\n\t\ttype?: keyof IExportOptions\r\n\t},\r\n\r\n\tlabelClass: {\r\n\t\tclassName: string,\r\n\t\tlevel: number,\r\n\t\ttype?: keyof IExportOptions\r\n\t},\r\n\r\n\tmenuTag: {\r\n\t\ttag: string\r\n\t},\r\n\r\n\titemTag: {\r\n\t\ttag: string\r\n\t},\r\n\r\n\tlabelTag: {\r\n\t\ttag: string\r\n\t},\r\n\r\n\ticonTag: {\r\n\t\ttag: string\r\n\t},\r\n\r\n\talign: {\r\n\t\talign: Align\r\n\t},\r\n\r\n\tverticalAlign: {\r\n\t\tverticalAlign: VerticalAlign\r\n\t},\r\n\r\n\tclassPrefix: {\r\n\t\tclassPrefix: string\r\n\t},\r\n\r\n\tdefaultStyles: {\r\n\t\tdefaultStyles: boolean\r\n\t},\r\n\r\n\ttabindex: {\r\n\t\ttabindex: number\r\n\t},\r\n\r\n\tcloseOnClick: boolean\r\n\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Creates a menu for Export operations.\r\n *\r\n * To add an export menu to a chart, set this to a new instance of\r\n * [[ExportMenu]].\r\n *\r\n * ```TypeScript\r\n * chart.exporting.menu = new am4core.ExportMenu();\r\n * ```\r\n * ```JavaScript\r\n * chart.exporting.menu = new am4core.ExportMenu();\r\n * ```\r\n * ```JSON\r\n * {\r\n *   // ...\r\n *   \"exporting\": {\r\n *     \"menu\": {}\r\n *   }\r\n * }\r\n * ```\r\n * @important\r\n */\r\nexport class ExportMenu extends Validatable {\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IExportMenuEvents;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IExportMenuAdapters;\r\n\r\n\t/**\r\n\t * An [[Adapter]].\r\n\t */\r\n\tpublic adapter: Adapter<ExportMenu, IExportMenuAdapters> = new Adapter<ExportMenu, IExportMenuAdapters>(this);\r\n\r\n\t/**\r\n\t * How many milliseconds to hold menu/sub-menu open after it loses focus or\r\n\t * hover, before auto-closing it.\r\n\t *\r\n\t * @default 1000\r\n\t */\r\n\tpublic closeDelay: number = 1000;\r\n\r\n\t/**\r\n\t * Close the menu automatically when some export operation is triggered.\r\n\t *\r\n\t * @default true\r\n\t * @since 4.2.2\r\n\t */\r\n\tpublic closeOnClick: boolean = true;\r\n\r\n\t/**\r\n\t * An instance of [[Language]].\r\n\t */\r\n\tprotected _language = new MutableValueDisposer<Language>();\r\n\r\n\t/**\r\n\t * Reference to DOM element that holds Export menu.\r\n\t */\r\n\tprotected _container: $type.Optional<HTMLElement>;\r\n\r\n\t/**\r\n\t * Menu element.\r\n\t */\r\n\tprotected _element: $type.Optional<HTMLElement>;\r\n\r\n\t/**\r\n\t * Currently selected menu item.\r\n\t */\r\n\tprotected _currentSelection: $type.Optional<IExportMenuItem>;\r\n\r\n\t/**\r\n\t * What HTML tags to use to build menu.\r\n\t */\r\n\tprotected _menuTag: \"ul\" | \"div\" = \"ul\";\r\n\r\n\t/**\r\n\t * Which tag to use to enclose individual menu items.\r\n\t */\r\n\tprotected _itemTag: \"li\" | \"div\" = \"li\";\r\n\r\n\t/**\r\n\t * Tag to wrap menu item labels in.\r\n\t */\r\n\tprotected _labelTag: \"a\" = \"a\";\r\n\r\n\t/**\r\n\t * Tag to use for icons\r\n\t */\r\n\tprotected _iconTag: \"img\" = \"img\";\r\n\r\n\t/**\r\n\t * Prefix for class names applied to menu elements.\r\n\t */\r\n\tprotected _classPrefix: string = \"amexport\";\r\n\r\n\t/**\r\n\t * If set to `true` [[ExportMenu]] will load it's own external CSS when\r\n\t * instantiated.\r\n\t */\r\n\tprotected _defaultStyles: boolean = true;\r\n\r\n\t/**\r\n\t * Horizontal positioning.\r\n\t */\r\n\tprotected _align: Align = \"right\";\r\n\r\n\t/**\r\n\t * Vertical positioning.\r\n\t */\r\n\tprotected _verticalAlign: VerticalAlign = \"top\";\r\n\r\n\t/**\r\n\t * A tabindex to apply to Export Menu.\r\n\t */\r\n\tprotected _tabindex: number = 0;\r\n\r\n\t/**\r\n\t * Whether next menu close event should be ignored.\r\n\t */\r\n\tprotected _ignoreNextClose: boolean = false;\r\n\r\n\t/**\r\n\t * Default menu items.\r\n\t */\r\n\tprotected _items: Array<IExportMenuItem> = [\r\n\t\t{\r\n\t\t\t\"label\": \"...\",\r\n\t\t\t\"menu\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"label\": \"Image\",\r\n\t\t\t\t\t\"menu\": [\r\n\t\t\t\t\t\t{ \"type\": \"png\", \"label\": \"PNG\" },\r\n\t\t\t\t\t\t{ \"type\": \"jpg\", \"label\": \"JPG\" },\r\n\t\t\t\t\t\t{ \"type\": \"svg\", \"label\": \"SVG\" },\r\n\t\t\t\t\t\t{ \"type\": \"pdf\", \"label\": \"PDF\" }\r\n\t\t\t\t\t]\r\n\t\t\t\t}, {\r\n\t\t\t\t\t\"label\": \"Data\",\r\n\t\t\t\t\t\"menu\": [\r\n\t\t\t\t\t\t{ \"type\": \"json\", \"label\": \"JSON\" },\r\n\t\t\t\t\t\t{ \"type\": \"csv\", \"label\": \"CSV\" },\r\n\t\t\t\t\t\t{ \"type\": \"xlsx\", \"label\": \"XLSX\" },\r\n\t\t\t\t\t\t{ \"type\": \"html\", \"label\": \"HTML\" },\r\n\t\t\t\t\t\t{ \"type\": \"pdfdata\", \"label\": \"PDF\" }\r\n\t\t\t\t\t]\r\n\t\t\t\t}, {\r\n\t\t\t\t\t\"label\": \"Print\", \"type\": \"print\"\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t];\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"ExportMenu\";\r\n\t\tthis._disposers.push(this._language);\r\n\t\tthis.invalidate();\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * (Re)draws the Export menu.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validate(): void {\r\n\t\tthis.draw();\r\n\t\tsuper.validate();\r\n\t}\r\n\r\n\t/**\r\n\t * Draws the menu based on current items.\r\n\t *\r\n\t * Normally, there's no need to call this explicitly. The chart, if it has\r\n\t * export menu enabled, will automatically draw the menu.\r\n\t */\r\n\tpublic draw(): void {\r\n\r\n\t\t// Create top-level menu item, or clear it\r\n\t\tif (!this._element) {\r\n\t\t\tthis._element = this.createMenuElement(0);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._element.innerHTML = \"\";\r\n\t\t\tthis._element.className = this.getMenuItemClass(0);\r\n\t\t}\r\n\r\n\t\t// See if we're loading external CSS\r\n\t\t// Hide it until CSS is loaded\r\n\t\tif (this.defaultStyles) {\r\n\t\t\tthis._element.style.display = \"none\";\r\n\t\t}\r\n\r\n\t\t// Append to container\r\n\t\t$type.getValue(this._container).appendChild(this._element);\r\n\r\n\t\t// Apply adapter to menu items before processing\r\n\t\tlet items = this.adapter.apply(\"items\", {\r\n\t\t\titems: this._items\r\n\t\t}).items;\r\n\r\n\t\tfor (let len = items.length, i = 0; i < len; i++) {\r\n\t\t\tthis.drawBranch(this._element, items[i], 0);\r\n\t\t}\r\n\r\n\t\t// Apply adapter to finalized menu element\r\n\t\tthis._element = this.adapter.apply(\"menuElement\", {\r\n\t\t\tmenuElement: this._element\r\n\t\t}).menuElement;\r\n\r\n\t\t// Set up global \"down\" event\r\n\t\tthis._disposers.push(getInteraction().body.events.on(\"down\", (ev) => {\r\n\t\t\tif (!ev.pointer.touch) {\r\n\t\t\t\tthis._ignoreNextClose = false;\r\n\t\t\t}\r\n\t\t\tthis.close();\r\n\t\t}));\r\n\r\n\t\t// Set up global event on ESC press to close the menu\r\n\t\tthis._disposers.push(getInteraction().body.events.on(\"keyup\", (ev) => {\r\n\t\t\tlet key = keyboard.getEventKey(ev.event);\r\n\t\t\tswitch (key) {\r\n\t\t\t\tcase \"esc\":\r\n\t\t\t\t\tthis.close();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"up\":\r\n\t\t\t\tcase \"down\":\r\n\t\t\t\tcase \"left\":\r\n\t\t\t\tcase \"right\":\r\n\t\t\t\t\tthis.moveSelection(key);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tif (this.defaultStyles) {\r\n\t\t\tthis.loadDefaultCSS();\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new branch in export menu. This function is recursive for\r\n\t * building multi-level menus.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param container Container to put branch elements in\r\n\t * @param branch    Menu item\r\n\t * @param level     Current nesting level\r\n\t */\r\n\tprotected drawBranch(container: HTMLElement, branch: IExportMenuItem, level: number): void {\r\n\r\n\t\t// Apply adapter\r\n\t\tbranch = this.adapter.apply(\"branch\", {\r\n\t\t\tbranch: branch,\r\n\t\t\tlevel: level\r\n\t\t}).branch;\r\n\r\n\t\t// Unsupported?\r\n\t\t// ExportMenu does not check or know for specific browser/system\r\n\t\t// capabilities. It must happen in some other code and applied via Adapter.\r\n\t\t// Export itself will check compatibility, but there might be other plugins\r\n\t\t// that influence it or even add any specific export functionality.\r\n\t\tif (branch.unsupported === true) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Init ascendants\r\n\t\tif (!branch.ascendants) {\r\n\t\t\tbranch.ascendants = new List<IExportMenuItem>();\r\n\t\t}\r\n\r\n\t\t// Get type\r\n\t\tlet type: keyof IExportOptions | undefined | null = branch.type;\r\n\r\n\t\t// Create an item\r\n\t\tlet element = this.createItemElement(level, type);\r\n\r\n\t\t// Create label\r\n\t\tlet label;\r\n\r\n\t\t// Create icon\r\n\t\tif (branch.icon) {\r\n\t\t\tlabel = this.createIconElement(level, type);\r\n\t\t\t(<HTMLImageElement>label).src = branch.icon;\r\n\t\t\tif (branch.label) {\r\n\t\t\t\t(<HTMLImageElement>label).title = branch.label;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (branch.svg) {\r\n\t\t\tlabel = this.createSvgElement(level, type, branch.svg);\r\n\t\t\tif (branch.label) {\r\n\t\t\t\t(<HTMLElement>label).title = branch.label;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlabel = this.createLabelElement(level, type);\r\n\t\t\tlabel.innerHTML = (branch.label ? this.language.translate(<keyof ILocaleProperties>branch.label) : \"\");\r\n\t\t}\r\n\r\n\t\t// Apply reader text to label\r\n\t\tlet readerLabel = this.getReaderLabel(branch, label.innerHTML);\r\n\t\tlabel.setAttribute(\"aria-label\", readerLabel);\r\n\r\n\t\t// Add Label\r\n\t\telement.appendChild(label);\r\n\r\n\t\t// Create interaction object\r\n\t\t// TODO clean this up when it's disposed\r\n\t\tbranch.interactions = getInteraction().getInteraction(label);\r\n\t\tbranch.element = element;\r\n\r\n\t\t// Create interaction manager we can set event listeners to\r\n\t\tif (this.typeClickable(type)) {\r\n\t\t\t//branch.interactions.clickable = true;\r\n\t\t\t// TODO clean this up when it's disposed\r\n\t\t\tbranch.interactions.events.on(\"hit\", (ev) => {\r\n\t\t\t\tif (this.events.isEnabled(\"hit\")) {\r\n\t\t\t\t\tconst event: AMEvent<this, IExportMenuEvents>[\"hit\"] = {\r\n\t\t\t\t\t\t\"type\": \"hit\",\r\n\t\t\t\t\t\t\"event\": ev.event,\r\n\t\t\t\t\t\t\"target\": this,\r\n\t\t\t\t\t\t\"branch\": branch\r\n\t\t\t\t\t};\r\n\t\t\t\t\tthis.events.dispatchImmediately(\"hit\", event);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// TODO clean this up when it's disposed\r\n\t\t\tbranch.interactions.events.on(\"keyup\", (ev) => {\r\n\t\t\t\tif (keyboard.isKey(ev.event, \"enter\")) {\r\n\t\t\t\t\tif (this.events.isEnabled(\"enter\")) {\r\n\t\t\t\t\t\tconst event: AMEvent<this, IExportMenuEvents>[\"enter\"] = {\r\n\t\t\t\t\t\t\t\"type\": \"enter\",\r\n\t\t\t\t\t\t\t\"event\": ev.event,\r\n\t\t\t\t\t\t\t\"target\": this,\r\n\t\t\t\t\t\t\t\"branch\": branch\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis.events.dispatchImmediately(\"enter\", event);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t{\r\n\t\t\tconst submenu = this.getSubMenu(branch);\r\n\r\n\t\t\t// Add ENTER event to open sub-menus\r\n\t\t\tif (submenu != null) {\r\n\t\t\t\t// TODO clean this up when it's disposed\r\n\t\t\t\tbranch.interactions.events.on(\"keyup\", (ev) => {\r\n\t\t\t\t\tif (keyboard.isKey(ev.event, \"enter\")) {\r\n\t\t\t\t\t\t// This is item has sub-menu, activate the first child on ENTER\r\n\t\t\t\t\t\tthis.selectBranch(submenu[0]);\r\n\r\n\t\t\t\t\t\t// Attempt to set focus\r\n\t\t\t\t\t\tthis.setFocus(submenu[0]);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbranch.interactions.events.on(\"hit\", (ev) => {\r\n\t\t\t\t\tthis.selectBranch(branch);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Add events\r\n\t\t// TODO clean this up when it's disposed\r\n\t\tbranch.interactions.events.on(\"over\", (ev) => {\r\n\r\n\t\t\tif (ev.pointer.touch) {\r\n\t\t\t\t// Cancel pending menu closure\r\n\t\t\t\tthis._ignoreNextClose = true;\r\n\t\t\t}\r\n\r\n\t\t\tthis.selectBranch(branch);\r\n\r\n\t\t\tif (this.events.isEnabled(\"over\")) {\r\n\t\t\t\tconst event: AMEvent<this, IExportMenuEvents>[\"over\"] = {\r\n\t\t\t\t\t\"type\": \"over\",\r\n\t\t\t\t\t\"event\": ev.event,\r\n\t\t\t\t\t\"target\": this,\r\n\t\t\t\t\t\"branch\": branch\r\n\t\t\t\t};\r\n\t\t\t\tthis.events.dispatchImmediately(\"over\", event);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// TODO clean this up when it's disposed\r\n\t\tbranch.interactions.events.on(\"out\", (ev) => {\r\n\t\t\tif (!ev.pointer.touch) {\r\n\t\t\t\tthis.delayUnselectBranch(branch);\r\n\t\t\t}\r\n\t\t\tif (this.events.isEnabled(\"out\")) {\r\n\t\t\t\tconst event: AMEvent<this, IExportMenuEvents>[\"out\"] = {\r\n\t\t\t\t\t\"type\": \"out\",\r\n\t\t\t\t\t\"event\": ev.event,\r\n\t\t\t\t\t\"target\": this,\r\n\t\t\t\t\t\"branch\": branch\r\n\t\t\t\t};\r\n\t\t\t\tthis.events.dispatchImmediately(\"out\", event);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// TODO clean this up when it's disposed\r\n\t\tbranch.interactions.events.on(\"focus\", (ev) => {\r\n\t\t\tthis.selectBranch(branch);\r\n\t\t});\r\n\r\n\t\t// TODO clean this up when it's disposed\r\n\t\tbranch.interactions.events.on(\"blur\", (ev) => {\r\n\t\t\tthis.delayUnselectBranch(branch);\r\n\t\t});\r\n\r\n\t\t// Increment level\r\n\t\tlet local_level = level + 1;\r\n\r\n\t\t// Has sub-menu?\r\n\t\tif (branch.menu) {\r\n\t\t\tlet submenu = this.createMenuElement(local_level);\r\n\t\t\tfor (let len = branch.menu.length, i = 0; i < len; i++) {\r\n\t\t\t\tlet ascendants = new List<IExportMenuItem>();\r\n\t\t\t\tbranch.menu[i].ascendants = ascendants;\r\n\t\t\t\tif (branch.ascendants.length) {\r\n\t\t\t\t\tascendants.copyFrom(branch.ascendants);\r\n\t\t\t\t}\r\n\t\t\t\tascendants.push(branch);\r\n\t\t\t\tthis.drawBranch(submenu, branch.menu[i], local_level);\r\n\t\t\t}\r\n\r\n\t\t\t// Sub-menu is empty (all items are not supported)\r\n\t\t\t// Do not draw this menu item at all\r\n\t\t\tif (submenu.innerHTML == \"\") {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telement.appendChild(submenu);\r\n\t\t}\r\n\r\n\t\t// Should this item be hidden?\r\n\t\tif (branch.hidden) {\r\n\t\t\tthis.hideBranch(branch);\r\n\t\t}\r\n\r\n\t\t// Add id?\r\n\t\tif (branch.id) {\r\n\t\t\telement.setAttribute(\"id\", branch.id);\r\n\t\t}\r\n\r\n\t\t// Background color?\r\n\t\tif (branch.color) {\r\n\t\t\telement.style.backgroundColor = branch.color.hex;\r\n\t\t}\r\n\r\n\t\t// Append to container\r\n\t\tcontainer.appendChild(element);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a menu element to hold its elements in. Usually it's an `<ul>`\r\n\t * tag.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param level  Current nesting level\r\n\t * @return HTML element reference\r\n\t */\r\n\tpublic createMenuElement(level: number): HTMLElement {\r\n\t\tlet element: HTMLElement = document.createElement(this.menuTag);\r\n\t\telement.className = this.getMenuItemClass(level);\r\n\r\n\t\t// Accessibility\r\n\t\tif (level === 0) {\r\n\t\t\telement.setAttribute(\"role\", \"menu\");\r\n\t\t}\r\n\t\treturn element;\r\n\t}\r\n\r\n\t/**\r\n\t * Generates a class name for the menu element based on its nesting level.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param level  Current nesting level\r\n\t * @return Class name(s)\r\n\t */\r\n\tpublic getMenuItemClass(level: number): string {\r\n\t\tlet className = this.classPrefix + \"-menu \" + this.classPrefix + \"-menu-level-\" + level;\r\n\t\tif (level === 0) {\r\n\t\t\tclassName += \" \" + this.classPrefix + \"-menu-root \" +\r\n\t\t\t\tthis.classPrefix + \"-\" + this.align + \" \" +\r\n\t\t\t\tthis.classPrefix + \"-\" + this.verticalAlign;\r\n\t\t}\r\n\t\treturn this.adapter.apply(\"menuClass\", {\r\n\t\t\tclassName: className,\r\n\t\t\tlevel: level\r\n\t\t}).className;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates menu item. Usually `<li>` tag. Its label and sub-elements will go\r\n\t * into this element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param level  Current nesting level\r\n\t * @param type   Type of the menu item\r\n\t * @return HTML element reference\r\n\t */\r\n\tpublic createItemElement(level: number, type?: keyof IExportOptions): HTMLElement {\r\n\t\tlet element: HTMLElement = document.createElement(this.itemTag);\r\n\t\tlet className = this.classPrefix + \"-item \" + this.classPrefix\r\n\t\t\t+ \"-item-level-\" + level\r\n\t\t\t+ \" \" + this.classPrefix + \"-item-\" + (type || \"blank\");\r\n\t\telement.className = this.adapter.apply(\"itemClass\", {\r\n\t\t\tclassName: className,\r\n\t\t\tlevel: level,\r\n\t\t\ttype: type\r\n\t\t}).className;\r\n\t\telement.setAttribute(\"role\", \"menuitem\");\r\n\t\treturn element;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a \"label\" part of the menu item. It could be text or any HTML\r\n\t * content.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param level  Current nesting level\r\n\t * @param type   Type of the menu item\r\n\t * @return An HTML Element\r\n\t */\r\n\tpublic createLabelElement(level: number, type?: keyof IExportOptions): HTMLElement {\r\n\t\tlet element: HTMLElement = document.createElement(this.labelTag);\r\n\t\tlet className = this.classPrefix + \"-label \" + this.classPrefix\r\n\t\t\t+ \"-label-level-\" + level\r\n\t\t\t+ \" \" + this.classPrefix + \"-item-\" + (type || \"blank\");\r\n\t\tif (this.typeClickable(type)) {\r\n\t\t\tclassName += \" \" + this.classPrefix + \"-clickable\";\r\n\t\t}\r\n\t\telement.className = this.adapter.apply(\"labelClass\", {\r\n\t\t\tclassName: className,\r\n\t\t\tlevel: level,\r\n\t\t\ttype: type\r\n\t\t}).className;\r\n\r\n\t\t// Accessible navigation\r\n\t\telement.setAttribute(\"tabindex\", this.tabindex.toString());\r\n\t\telement.setAttribute(\"role\", \"menuitem\");\r\n\t\treturn element;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a \"icon\" part of the menu item.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param level  Current nesting level\r\n\t * @param type   Type of the menu item\r\n\t * @return An HTML Element\r\n\t */\r\n\tpublic createIconElement(level: number, type?: keyof IExportOptions): HTMLElement {\r\n\t\tlet element: HTMLElement = document.createElement(this.iconTag);\r\n\t\tlet className = this.classPrefix + \"-icon \" + this.classPrefix\r\n\t\t\t+ \"-icon-level-\" + level\r\n\t\t\t+ \" \" + this.classPrefix + \"-item-\" + (type || \"blank\");\r\n\t\tif (this.typeClickable(type)) {\r\n\t\t\tclassName += \" \" + this.classPrefix + \"-clickable\";\r\n\t\t}\r\n\t\telement.className = this.adapter.apply(\"labelClass\", {\r\n\t\t\tclassName: className,\r\n\t\t\tlevel: level,\r\n\t\t\ttype: type\r\n\t\t}).className;\r\n\r\n\t\t// Accessible navigation\r\n\t\telement.setAttribute(\"tabindex\", this.tabindex.toString());\r\n\t\telement.setAttribute(\"role\", \"menuitem\");\r\n\t\treturn element;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a a custom element out of raw HTML.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param level  Current nesting level\r\n\t * @param type   Type of the menu item\r\n\t * @return An HTML Element\r\n\t */\r\n\tpublic createSvgElement(level: number, type?: keyof IExportOptions, svg?: string): HTMLElement {\r\n\t\tlet parser = new DOMParser();\r\n\t\tlet element = parser.parseFromString(svg, \"image/svg+xml\").documentElement;\r\n\t\tlet className = this.classPrefix + \"-icon \" + this.classPrefix\r\n\t\t\t+ \"-icon-level-\" + level\r\n\t\t\t+ \" \" + this.classPrefix + \"-item-\" + (type || \"blank\");\r\n\t\tif (this.typeClickable(type)) {\r\n\t\t\tclassName += \" \" + this.classPrefix + \"-clickable\";\r\n\t\t}\r\n\t\telement.setAttribute(\"class\", this.adapter.apply(\"labelClass\", {\r\n\t\t\tclassName: className,\r\n\t\t\tlevel: level,\r\n\t\t\ttype: type\r\n\t\t}).className);\r\n\r\n\t\t// Accessible navigation\r\n\t\telement.setAttribute(\"tabindex\", this.tabindex.toString());\r\n\t\telement.setAttribute(\"role\", \"menuitem\");\r\n\t\treturn element;\r\n\t}\r\n\r\n\t/**\r\n\t * Destroys the menu and all its elements.\r\n\t */\r\n\tpublic dispose(): void {\r\n\t\tif (!this._disposed) {\r\n\t\t\tsuper.dispose();\r\n\r\n\t\t\tif (this._element && this._element.parentNode) {\r\n\t\t\t\tthis._element.parentNode.removeChild(this._element);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether menu item type is supposed to be clickable.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param type  Menu item type\r\n\t * @return Is clickable?\r\n\t */\r\n\tpublic typeClickable(type: keyof IExportOptions | undefined | null): type is keyof IExportOptions {\r\n\t\treturn $type.hasValue(type);\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether menu item has any sub-items.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch  A menu item\r\n\t * @return Has sub-items?\r\n\t */\r\n\tpublic hasSubMenu(branch: IExportMenuItem): boolean {\r\n\t\treturn (branch.menu && branch.menu.length) ? true : false;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns sub-items (if they exist).\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch  A menu item\r\n\t * @return Submenus\r\n\t */\r\n\tpublic getSubMenu(branch: IExportMenuItem): $type.Optional<Array<IExportMenuItem>> {\r\n\t\tif (branch.menu && branch.menu.length) {\r\n\t\t\treturn branch.menu;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Generates and returns an applicable label to be used for screen readers.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param item   A menu item instance\r\n\t * @param label  Current label\r\n\t * @return Reader text\r\n\t */\r\n\tpublic getReaderLabel(branch: IExportMenuItem, label: string): string {\r\n\r\n\t\t// Strip any HTML from the label\r\n\t\tlabel = $utils.stripTags(label);\r\n\r\n\t\t// Add textual note if the branch is clickable\r\n\t\tif (this.hasSubMenu(branch)) {\r\n\t\t\tlabel += \" [\" + this.language.translate(\"Click, tap or press ENTER to open\") + \"]\";\r\n\t\t}\r\n\t\telse if (branch.type == \"print\") {\r\n\t\t\tlabel = this.language.translate(\"Click, tap or press ENTER to print.\");\r\n\t\t}\r\n\t\telse if (this.typeClickable(branch.type)) {\r\n\t\t\tlabel = this.language.translate(\"Click, tap or press ENTER to export as %1.\", undefined, label);\r\n\t\t}\r\n\r\n\t\treturn this.adapter.apply(\"rederLabel\", {\r\n\t\t\tlabel: label,\r\n\t\t\tbranch: branch\r\n\t\t}).label;\r\n\t}\r\n\r\n\t/**\r\n\t * Getters and setters\r\n\t */\r\n\r\n\t/**\r\n\t * An HTML container to place the Menu in.\r\n\t *\r\n\t * A container must be an HTML element, because menu itself is HTML, and\r\n\t * cannot be placed into SVG.\r\n\t *\r\n\t * @param container Reference to container element\r\n\t * @todo Check if menu is already build. If it is, just move it to a new container\r\n\t */\r\n\tpublic set container(container: $type.Optional<HTMLElement>) {\r\n\t\tthis._container = container;\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Container\r\n\t */\r\n\tpublic get container(): $type.Optional<HTMLElement> {\r\n\t\treturn this._container;\r\n\t}\r\n\r\n\t/**\r\n\t * A list of menu items. Can be nested.\r\n\t *\r\n\t * @param items  Menu items\r\n\t */\r\n\tpublic set items(items: Array<IExportMenuItem>) {\r\n\t\tthis._items = items;\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Menu items\r\n\t */\r\n\tpublic get items(): Array<IExportMenuItem> {\r\n\t\treturn this._items;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets main menu tag to place menu in.\r\n\t *\r\n\t * This also sets up how menu items are built.\r\n\t *\r\n\t * If you set this to \"ul\", menu items will be wrapped into `<li>` tags.\r\n\t *\r\n\t * If set to \"div\", menu items will be wrapped in `<div>` tags.\r\n\t *\r\n\t * @default \"ul\"\r\n\t * @param tag Tag to use for menu\r\n\t */\r\n\tpublic set tag(tag: \"ul\" | \"div\") {\r\n\t\tthis._menuTag = tag;\r\n\t\tthis._itemTag = tag == \"ul\" ? \"li\" : \"div\";\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current menu tag.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Menu tag (item that contains sub-items)\r\n\t */\r\n\tpublic get menuTag(): string {\r\n\t\treturn this.adapter.apply(\"menuTag\", {\r\n\t\t\ttag: this._menuTag\r\n\t\t}).tag;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns tag to wrap items into.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Item tag\r\n\t */\r\n\tpublic get itemTag(): string {\r\n\t\treturn this.adapter.apply(\"itemTag\", {\r\n\t\t\ttag: this._itemTag\r\n\t\t}).tag;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns menu label tag.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Label tag\r\n\t */\r\n\tpublic get labelTag(): string {\r\n\t\treturn this.adapter.apply(\"labelTag\", {\r\n\t\t\ttag: this._labelTag\r\n\t\t}).tag;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns icon tag.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Icon tag\r\n\t */\r\n\tpublic get iconTag(): string {\r\n\t\treturn this.adapter.apply(\"iconTag\", {\r\n\t\t\ttag: this._iconTag\r\n\t\t}).tag;\r\n\t}\r\n\r\n\t/**\r\n\t * A horizontal alignment for the menu placement.\r\n\t *\r\n\t * @param value Horizontal alignment\r\n\t */\r\n\tpublic set align(value: Align) {\r\n\t\tthis._align = value;\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Horizontal alignment\r\n\t */\r\n\tpublic get align(): Align {\r\n\t\treturn this.adapter.apply(\"align\", {\r\n\t\t\talign: this._align\r\n\t\t}).align;\r\n\t}\r\n\r\n\t/**\r\n\t * A vertical alignment for the menu placement.\r\n\t *\r\n\t * @param value Vertical alignment\r\n\t */\r\n\tpublic set verticalAlign(value: VerticalAlign) {\r\n\t\tthis._verticalAlign = value;\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Vertical alignment\r\n\t */\r\n\tpublic get verticalAlign(): VerticalAlign {\r\n\t\treturn this.adapter.apply(\"verticalAlign\", {\r\n\t\t\tverticalAlign: this._verticalAlign\r\n\t\t}).verticalAlign;\r\n\t}\r\n\r\n\t/**\r\n\t * Class name prefix.\r\n\t *\r\n\t * @default \"amexport\"\r\n\t * @param value Class name prefix\r\n\t */\r\n\tpublic set classPrefix(value: string) {\r\n\t\tthis._classPrefix = value;\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Class name prefix\r\n\t */\r\n\tpublic get classPrefix(): string {\r\n\t\treturn this.adapter.apply(\"classPrefix\", {\r\n\t\t\tclassPrefix: this._classPrefix\r\n\t\t}).classPrefix;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether [[ExportMenu]] should load external CSS to style itself.\r\n\t *\r\n\t * If set to `false`, the menu will not be styled, and will rely on some\r\n\t * external CSS.\r\n\t *\r\n\t * @default true\r\n\t * @param Should ExportMenu load its own CSS?\r\n\t */\r\n\tpublic set defaultStyles(value: boolean) {\r\n\t\tif (this._defaultStyles != value) {\r\n\t\t\tthis._defaultStyles = value;\r\n\t\t\tif (value) {\r\n\t\t\t\tthis.loadDefaultCSS();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Should ExportMenu load its own CSS?\r\n\t */\r\n\tpublic get defaultStyles(): boolean {\r\n\t\treturn this.adapter.apply(\"defaultStyles\", {\r\n\t\t\tdefaultStyles: this._defaultStyles\r\n\t\t}).defaultStyles;\r\n\t}\r\n\r\n\t/**\r\n\t * Loads the default CSS.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic loadDefaultCSS(): void {\r\n\t\tthis._disposers.push(exportCSS($dom.getShadowRoot(this.container), this.classPrefix));\r\n\r\n\t\tif (this._element) {\r\n\t\t\tthis._element.style.display = \"\";\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A tab index for the menu.\r\n\t *\r\n\t * Tab index will influence the order in which elements on the chart and\r\n\t * the whole page are selected when pressing TAB key.\r\n\t *\r\n\t * @param value Tab index\r\n\t */\r\n\tpublic set tabindex(value: number) {\r\n\t\tthis._tabindex = value;\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Tab index\r\n\t */\r\n\tpublic get tabindex(): number {\r\n\t\treturn this.adapter.apply(\"tabindex\", {\r\n\t\t\ttabindex: this._tabindex\r\n\t\t}).tabindex;\r\n\t}\r\n\r\n\t/**\r\n\t * A [[Language]] instance.\r\n\t *\r\n\t * @param value An instance of [[Language]]\r\n\t */\r\n\tpublic set language(value: Language) {\r\n\t\tthis._language.set(value, value.events.on(\"localechanged\", (ev) => {\r\n\t\t\tthis.invalidate();\r\n\t\t}));\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return A [[Language]] instance to be used\r\n\t */\r\n\tpublic get language(): Language {\r\n\t\tlet language = this._language.get();\r\n\r\n\t\tif (language == null) {\r\n\t\t\tlanguage = new Language();\r\n\r\n\t\t\t// TODO code duplication with `set language()`\r\n\t\t\tthis._language.set(language, language.events.on(\"localechanged\", (ev) => {\r\n\t\t\t\tthis.invalidate();\r\n\t\t\t}));\r\n\t\t}\r\n\r\n\t\treturn language;\r\n\t}\r\n\r\n\t/**\r\n\t * Controlling the menu\r\n\t */\r\n\r\n\t/**\r\n\t * Removes all active classes from menu items. Useful on touch devices and\r\n\t * keyboard navigation where open menu can be closed instantly by clicking or\r\n\t * tapping outside it.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic close(): void {\r\n\t\tif (this._ignoreNextClose) {\r\n\t\t\tthis._ignoreNextClose = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.closeOnClick) {\r\n\t\t\tthis._element.style.pointerEvents = \"none\";\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis._element.style.pointerEvents = \"auto\";\r\n\t\t\t}, 100);\r\n\t\t}\r\n\r\n\t\tif (this._currentSelection) {\r\n\t\t\tthis.setBlur(this._currentSelection);\r\n\t\t\tthis._currentSelection = undefined;\r\n\t\t}\r\n\r\n\t\tif (this._element) {\r\n\t\t\tlet items = this._element.getElementsByClassName(\"active\");\r\n\t\t\tfor (let len = items.length, i = len - 1; i >= 0; i--) {\r\n\t\t\t\tif (items[i]) {\r\n\t\t\t\t\t$dom.removeClass(<HTMLElement>items[i], \"active\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.events.dispatchImmediately(\"closed\", {\r\n\t\t\ttype: \"closed\",\r\n\t\t\ttarget: this\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Selects a branch in the menu.\r\n\t *\r\n\t * Handles closing of currently open branch.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch Branch to select\r\n\t */\r\n\tpublic selectBranch(branch: IExportMenuItem): void {\r\n\r\n\t\t// Cancel previous closure\r\n\t\tif (branch.closeTimeout) {\r\n\t\t\tthis.removeDispose(branch.closeTimeout);\r\n\t\t\tbranch.closeTimeout = undefined;\r\n\t\t}\r\n\r\n\t\t// Add active class\r\n\t\t$dom.addClass(branch.interactions.element.parentElement, \"active\");\r\n\r\n\t\t// Remove current selection\r\n\t\tif (this._currentSelection && this._currentSelection !== branch && this._currentSelection.ascendants) {\r\n\t\t\t$iter.each($iter.concat($iter.fromArray([this._currentSelection]), this._currentSelection.ascendants.iterator()), (ascendant) => {\r\n\t\t\t\tif (!branch.ascendants.contains(ascendant) && branch !== ascendant) {\r\n\t\t\t\t\tthis.unselectBranch(ascendant, true);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Select and/or cancel timeout for current ascendants\r\n\t\t$iter.each(branch.ascendants.iterator(), (ascendant) => {\r\n\t\t\tif (ascendant.closeTimeout) {\r\n\t\t\t\tthis.removeDispose(ascendant.closeTimeout);\r\n\t\t\t\tascendant.closeTimeout = undefined;\r\n\t\t\t}\r\n\t\t\t$dom.addClass(ascendant.interactions.element.parentElement, \"active\");\r\n\t\t});\r\n\r\n\t\t// Log current selection\r\n\t\tthis._currentSelection = branch;\r\n\r\n\t\t// Invoke event\r\n\t\tif (this.events.isEnabled(\"branchselected\")) {\r\n\t\t\tconst event: AMEvent<this, IExportMenuEvents>[\"branchselected\"] = {\r\n\t\t\t\ttype: \"branchselected\",\r\n\t\t\t\ttarget: this,\r\n\t\t\t\tbranch: branch\r\n\t\t\t};\r\n\t\t\tthis.events.dispatchImmediately(\"branchselected\", event);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Unselects a branch. Also selects a branch one level up if necessary.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch Branch to unselect\r\n\t * @param simple If `true`, only the branch will be unselected without selecting parent branch\r\n\t */\r\n\tpublic unselectBranch(branch: IExportMenuItem, simple?: boolean): void {\r\n\r\n\t\t// Remove active class\r\n\t\t$dom.removeClass(branch.interactions.element.parentElement, \"active\");\r\n\r\n\t\t// Remove current selection\r\n\t\tif (this._currentSelection == branch) {\r\n\t\t\tthis._currentSelection = undefined;\r\n\t\t}\r\n\r\n\t\t// Invoke event\r\n\t\tif (this.events.isEnabled(\"branchunselected\")) {\r\n\t\t\tconst event: AMEvent<this, IExportMenuEvents>[\"branchunselected\"] = {\r\n\t\t\t\ttype: \"branchunselected\",\r\n\t\t\t\ttarget: this,\r\n\t\t\t\tbranch: branch\r\n\t\t\t};\r\n\t\t\tthis.events.dispatchImmediately(\"branchunselected\", event);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Delay unselection of a branch. This can still be cancelled in some other\r\n\t * place if the branch or its children regain focus.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch Branch to unselect\r\n\t * @param simple If `true`, only the branch will be unselected without selecting parent branch\r\n\t */\r\n\tpublic delayUnselectBranch(branch: IExportMenuItem, simple?: boolean): void {\r\n\r\n\t\t// Schedule branch unselection\r\n\t\tif (branch.closeTimeout) {\r\n\t\t\tthis.removeDispose(branch.closeTimeout);\r\n\t\t\tbranch.closeTimeout = undefined;\r\n\t\t}\r\n\t\tbranch.closeTimeout = this.setTimeout(() => {\r\n\t\t\tthis.unselectBranch(branch, simple);\r\n\t\t}, this.closeDelay);\r\n\r\n\t\t// Schedule unselection of all ascendants\r\n\t\t// In case focus went away from the export menu altogether, this will ensure\r\n\t\t// that all items will be closed.\r\n\t\t// In case we're jumping to other menu item, those delayed unselections will\r\n\t\t// be cancelled by `selectBranch`\r\n\t\tif (simple !== true && branch.ascendants) {\r\n\t\t\t$iter.each(branch.ascendants.iterator(), (ascendant) => {\r\n\t\t\t\tthis.delayUnselectBranch(ascendant, true);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Navigates the menu based on which direction kayboard key was pressed.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param key A key that was pressed\r\n\t */\r\n\tpublic moveSelection(key: KeyboardKeys): void {\r\n\r\n\t\t// Check if there's a current selection\r\n\t\tif (!this._currentSelection) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet newSelection: $type.Optional<IExportMenuItem>;\r\n\r\n\t\tif (key == \"up\") {\r\n\t\t\t// Try moving up in current menu list, or to the last item if already\r\n\t\t\t// at the top\r\n\t\t\tnewSelection = this.getPrevSibling(this._currentSelection);\r\n\t\t}\r\n\t\telse if (key == \"down\") {\r\n\t\t\t// Try moving down in current menu list, or to the top item if already\r\n\t\t\t// at the bottom\r\n\t\t\tnewSelection = this.getNextSibling(this._currentSelection);\r\n\t\t}\r\n\t\telse if ((key == \"left\" && this.align == \"right\") || (key == \"right\" && this.align == \"left\")) {\r\n\t\t\tlet menu = this.getSubMenu(this._currentSelection);\r\n\r\n\t\t\t// Go one level-deeper\r\n\t\t\tif (menu != null) {\r\n\t\t\t\tnewSelection = menu[0];\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if ((key == \"right\" && this.align == \"right\") || (key == \"left\" && this.align == \"left\")) {\r\n\t\t\t// Go one level-deeper\r\n\t\t\tnewSelection = this.getParentItem(this._currentSelection);\r\n\t\t}\r\n\r\n\t\tif (newSelection && newSelection !== this._currentSelection) {\r\n\t\t\tthis.selectBranch(newSelection);\r\n\t\t\tthis.setFocus(newSelection);\r\n\t\t\tthis._currentSelection = newSelection;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Returns all siblings of a menu item, including this same menu item.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch  Menu item\r\n\t * @return List of sibling menu items\r\n\t */\r\n\tpublic getSiblings(branch: IExportMenuItem): Array<IExportMenuItem> {\r\n\t\tlet parent = this.getParentItem(branch);\r\n\r\n\t\tif (parent && parent.menu) {\r\n\t\t\treturn parent.menu;\r\n\r\n\t\t} else {\r\n\t\t\treturn [];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns menu items parent item.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch  Menu item\r\n\t * @return Parent menu item\r\n\t */\r\n\tpublic getParentItem(branch: IExportMenuItem): $type.Optional<IExportMenuItem> {\r\n\t\tif (branch.ascendants && branch.ascendants.length) {\r\n\t\t\treturn branch.ascendants.getIndex(branch.ascendants.length - 1);\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns next sibling in the same menu branch. If there is no next sibling,\r\n\t * the first one is returned. If there is just one item, that item is\r\n\t * returned. Unsupported menu items are skipped.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch  Menu item to search siblings for\r\n\t * @return Menu item\r\n\t */\r\n\tpublic getNextSibling(branch: IExportMenuItem): IExportMenuItem {\r\n\t\tlet siblings = this.getSiblings(branch);\r\n\t\tif (siblings.length > 1) {\r\n\t\t\tlet next = siblings.indexOf(branch) + 1;\r\n\t\t\tnext = siblings.length == next ? 0 : next;\r\n\t\t\treturn siblings[next].unsupported ? this.getNextSibling(siblings[next]) : siblings[next];\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn branch;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns previous sibling in the same menu branch. If there is no next\r\n\t * sibling, the first one is returned. If there is just one item, that item is\r\n\t * returned. Unsupported menu items are skipped.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch  Menu item to search siblings for\r\n\t * @return Menu item\r\n\t */\r\n\tpublic getPrevSibling(branch: IExportMenuItem): IExportMenuItem {\r\n\t\tlet siblings = this.getSiblings(branch);\r\n\t\tif (siblings.length > 1) {\r\n\t\t\tlet prev = siblings.indexOf(branch) - 1;\r\n\t\t\tprev = prev == -1 ? siblings.length - 1 : prev;\r\n\t\t\treturn siblings[prev].unsupported ? this.getPrevSibling(siblings[prev]) : siblings[prev];\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn branch;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Attempts to set focus on particular menu element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch Menu item\r\n\t */\r\n\tpublic setFocus(branch: IExportMenuItem): void {\r\n\t\tif (branch.interactions) {\r\n\t\t\ttry {\r\n\t\t\t\t(<HTMLElement>branch.interactions.element).focus();\r\n\t\t\t}\r\n\t\t\tcatch(e) {\r\n\t\t\t\t// nothing\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Attempts to remove focus from the menu element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch Menu item\r\n\t */\r\n\tpublic setBlur(branch: IExportMenuItem): void {\r\n\t\tif (branch.interactions) {\r\n\t\t\ttry {\r\n\t\t\t\t(<HTMLElement>branch.interactions.element).blur();\r\n\t\t\t}\r\n\t\t\tcatch(e) {\r\n\t\t\t\t// nothing\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Hides the whole branch of menu.\r\n\t *\r\n\t * @param  branch  branch\r\n\t */\r\n\tpublic hideBranch(branch: IExportMenuItem): void {\r\n\t\tbranch.element.style.display = \"none\";\r\n\t}\r\n\r\n\t/**\r\n\t * Show the branch of menu.\r\n\t *\r\n\t * @param  branch  branch\r\n\t */\r\n\tpublic showBranch(branch: IExportMenuItem): void {\r\n\t\tbranch.element.style.display = \"\";\r\n\t}\r\n\r\n}\r\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}